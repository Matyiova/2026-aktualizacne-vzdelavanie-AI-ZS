
<!DOCTYPE html>
<html lang="de-DE">
<head>
  <meta charset="UTF-8">
  <title>ÄŒervenÃ¡ ÄiapoÄka - nemecky</title>
  <style>
    body { font-family: system-ui, Courier bold, monospace; padding: 20px; }
    #text { white-space: pre-wrap; margin-bottom: 1em; }
    button, select { margin: 0.3em; padding: 0.4em 0.8em; }
    .highlight { background-color: yellow; }
  </style>
</head>
<body>
  <div id="text">RotkÃ¤ppchen

Es war einmal ein kleines MÃ¤dchen. Alle nannten es RotkÃ¤ppchen, weil es immer ein rotes KÃ¤ppchen trug. Seine GroÃŸmutter hatte es ihr geschenkt.

Eines Tages sagte die Mutter: â€RotkÃ¤ppchen, bring deiner GroÃŸmutter Kuchen und Wein. Aber bleib auf dem Weg und sprich nicht mit Fremden.â€œ

RotkÃ¤ppchen versprach es und ging los. Im Wald traf es den Wolf. Der Wolf fragte freundlich: â€Wohin gehst du, RotkÃ¤ppchen?â€œ Es antwortete: â€Zur GroÃŸmutter. Sie wohnt hinter dem Wald.â€œ

Der Wolf dachte: Die GroÃŸmutter und das Kind â€“ das ist ein gutes Mahl. Er sagte: â€Schau, wie schÃ¶n die Blumen sind. PflÃ¼ck doch ein paar fÃ¼r deine GroÃŸmutter.â€œ RotkÃ¤ppchen vergaÃŸ das Versprechen und ging vom Weg ab.

Der Wolf lief schnell zum Haus der GroÃŸmutter. Er klopfte an die TÃ¼r. â€Wer ist da?â€œ fragte die GroÃŸmutter. â€Ich bin RotkÃ¤ppchenâ€œ, sagte der Wolf mit verstellter Stimme. Die GroÃŸmutter lieÃŸ ihn herein. Der Wolf verschluckte sie mit einem Bissen. Dann zog er ihre Kleider an, legte sich ins Bett und wartete.

Bald kam RotkÃ¤ppchen mit den Blumen. Es wunderte sich: â€Wie seltsam sieht die GroÃŸmutter aus!â€œ Es trat nÃ¤her ans Bett und sagte: â€GroÃŸmutter, warum hast du so groÃŸe Ohren?â€œ â€Damit ich dich besser hÃ¶ren kann.â€œ â€GroÃŸmutter, warum hast du so groÃŸe Augen?â€œ â€Damit ich dich besser sehen kann.â€œ â€GroÃŸmutter, warum hast du so groÃŸe ZÃ¤hne?â€œ â€Damit ich dich besser fressen kann!â€œ

Der Wolf sprang aus dem Bett und verschluckte auch RotkÃ¤ppchen.

Zum GlÃ¼ck kam ein JÃ¤ger vorbei. Er hÃ¶rte den Wolf schnarchen. Er trat ins Haus, sah den Wolf und schnitt ihm den Bauch auf. RotkÃ¤ppchen und die GroÃŸmutter sprangen lebendig heraus. Sie fÃ¼llten den Bauch des Wolfes mit Steinen. Als der Wolf aufwachte, konnte er nicht mehr laufen und fiel tot um.

RotkÃ¤ppchen versprach: â€Ich gehe nie wieder vom Weg ab und hÃ¶re auf meine Mutter.â€œ

Und so lebten sie glÃ¼cklich und sicher weiter.</div>

  <div>
    <label for="rateSelect">ğŸ”„ RÃ½chlosÅ¥: </label>
    <select id="rateSelect">
      <option value="0.7">0.7Ã—</option>
	  <option value="0.8">0.8Ã—</option>
      <option value="0.9">0.9Ã—</option>
      <option value="1" selected>1Ã— (normÃ¡lna)</option>
      <option value="1.2">1.2Ã—</option>
      <option value="1.5">1.5Ã—</option>
    </select>
  </div>

  <button onclick="speak()">â–¶ï¸ SpustiÅ¥</button>
  <button onclick="stopSpeaking()">â¹ï¸ ZastaviÅ¥</button>

  <script>
    const selectedLang = "de-DE";

    // --- LocalStorage pre rÃ½chlosÅ¥ ---
    window.addEventListener("load", () => {
      const savedRate = localStorage.getItem("rate");
      if (savedRate) {
        document.getElementById("rateSelect").value = savedRate;
      }
    });
    document.getElementById("rateSelect").addEventListener("change", e => {
      localStorage.setItem("rate", e.target.value);
    });

    function splitTextIntoChunks(text) {
      return text.split(/(?<=[.?!])\s+|\n{2,}/).filter(p => p.trim().length > 0);
    }

    function prepareChunks() {
      const container = document.getElementById("text");
      const rawText = container.textContent;
      const chunks = splitTextIntoChunks(rawText);

      container.innerHTML = "";
      chunks.forEach((chunk, i) => {
        const span = document.createElement("span");
        span.textContent = chunk + " ";
        span.id = "chunk-" + i;
        container.appendChild(span);
      });
      return chunks;
    }

    function speak() {
      const chunks = prepareChunks();
      const rate = parseFloat(document.getElementById("rateSelect").value);

      let index = 0;
      function speakChunk() {
        if (index >= chunks.length) return;
        const u = new SpeechSynthesisUtterance(chunks[index]);
        u.rate = rate;
        u.lang = selectedLang || "sk-SK";

        u.onstart = () => {
          document.querySelectorAll(".highlight").forEach(el => el.classList.remove("highlight"));
          const el = document.getElementById("chunk-" + index);
          if (el) el.classList.add("highlight");
        };

        let pause = /[.?!]$/.test(chunks[index]) ? 600 : 800;
        u.onend = () => { index++; setTimeout(speakChunk, pause); };
        speechSynthesis.speak(u);
      }

      speechSynthesis.cancel();
      speakChunk();
    }

    function stopSpeaking() {
      speechSynthesis.cancel();
      document.querySelectorAll(".highlight").forEach(el => el.classList.remove("highlight"));
    }
  </script>
</body>
</html>