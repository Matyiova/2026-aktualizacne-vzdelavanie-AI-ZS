<!doctype html>
<html lang="sk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Precvičovanie veľkej násobilky</title>
  <style>
    :root{
      --bg:#f7f7f7;
      --panel:#ffffff;
      --accent:#2b4a7a; /* Modrá téma pre veľkú násobilku */
      --error:#c62828;
      --muted:#dcdcdc;
      --cell-border:#888;
      --header-bg:#b0b0b0; /* Tmavšia šedá podľa obrázku */
    }
    html,body{height:100%;margin:0;background:var(--bg);font-family:monospace;}
    .container{
      max-width:1100px;
      margin:18px auto;
      padding:14px;
      background:var(--panel);
      box-shadow:0 6px 18px rgba(0,0,0,0.06);
      border-radius:8px;
    }
    .top-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:center;}
    label{font-weight:700;font-size:14px;}
    input[type="text"], input[type="number"]{
      font-family:monospace;padding:6px 8px;border:1px solid #ccc;border-radius:4px;font-size:14px;
    }
    input[type="number"]{width:84px;}
    button{font-family:monospace;padding:7px 10px;border-radius:6px;border:1px solid #888;background:#fff;cursor:pointer;font-size:14px;}
    button.primary{background:var(--accent);color:#fff;border-color:rgba(0,0,0,0.08);}
    .center{text-align:center;margin-top:12px;}
    h1{margin:6px 0 6px; font-size: 24px;}
    .instructions{ color:#333; margin-bottom: 4px; font-size: 150%; }
    .example{ font-size: 40px; font-weight:700; margin: 6px 0; line-height:1;}
    .message{ min-height: 17px; margin-top: 4px; font-weight: 700; font-size: 14px; }
    .message.error{ color: var(--error); }
    .message.warn{ color: #b36b00; }
    .grid-wrap{ display: flex; justify-content: center; margin-top: 12px; overflow-x: auto; }
    
    table.mtable{ border-collapse: collapse; font-size: 16px; max-width: 100%; }
    /* Bunky */
    table.mtable th, table.mtable td{
      border:1px solid var(--cell-border);
      width:48px; height:40px; /* Rozmery prispôsobené 3-ciferným číslam */
      text-align:center; vertical-align:middle; padding:0;
    }
    /* Hlavičky (šedé podľa obrázku) */
    table.mtable th{background:var(--header-bg);color:#000;font-weight:700;font-size:18px;}
    /* Prvá bunka vľavo hore (prázdna alebo šedá) */
    table.mtable th.corner{background:var(--header-bg);}
    
    table.mtable td.cell{cursor:pointer;background:#fff;user-select:none;font-size:18px;font-weight:400;}
    table.mtable td.cell:hover{outline:3px solid rgba(0,0,0,0.2);}
    
    td.correct{background:#c8e6c9 !important; font-weight: 700 !important;}
    
    .controls{display:flex;gap:10px;justify-content:center;margin-top:12px;flex-wrap:wrap;}
    .results{margin-top:12px;text-align:center;}
    .hidden{display:none;}
    .summary{margin-top:12px;padding:10px;border:1px dashed #ccc;border-radius:6px;background:#fafafa;font-size:14px;}
    .detail{margin-top:12px;}
    table.report{width:100%;border-collapse:collapse;font-size:14px;}
    table.report th, table.report td{border:1px solid #ddd;padding:8px;text-align:left;}
    .legend{margin-top:10px;font-size:14px;}
    .ok{color:green;font-weight:700;}
    .bad{color:crimson;font-weight:700;}

    /* Responzívne úpravy */
    @media (max-width:600px){
      .container{padding:10px;margin:5px;}
      .example{font-size:30px;}
      table.mtable th, table.mtable td{width:34px;height:34px;font-size:13px;}
      table.mtable th{font-size:14px;}
      input[type="number"]{width:60px;}
    }

    @media print {
      body * { visibility: hidden !important; }
      #detailView, #detailView * { visibility: visible !important; }
      #detailView { position: absolute !important; left: 0; top: 0; width: 100%; padding: 0.5cm; }
      .container, .detail { box-shadow: none !important; background: #fff !important; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="top-row">
      <div>
        <label for="studentName">Meno žiaka</label><br />
        <input id="studentName" type="text" placeholder="Zadajte meno" />
      </div>
      <div>
        <label for="taskCount">Počet úloh</label><br />
        <input id="taskCount" type="number" min="1" max="100" value="20" />
      </div>
      <div style="align-self:end;">
        <button id="startBtn" class="primary">Štart</button>
      </div>
    </div>

    <div class="center">
      <h1>Precvičovanie veľkej násobilky</h1>
      <div class="instructions">Klikni na správny výsledok násobenia. Dbaj na poradie činiteľov v zadaní.</div>

      <div id="exampleBox" class="example" aria-live="polite">— x — =</div>
      <div id="feedback" class="message"></div>

      <div class="grid-wrap">
        <table class="mtable" id="multTable" aria-label="Tabuľka násobenia"></table>
      </div>

      <div class="controls">
        <button id="finishBtn" class="hidden">Ukončiť cvičenie</button>
      </div>

      <div id="endControls" class="results hidden">
        <button id="evaluateBtn">Vyhodnotiť</button>
        <button id="detailBtn">Detailný prehľad</button>
        <button id="printBtn" class="hidden">Tlačiť prehľad</button>
      </div>

      <div id="scoreBox" class="summary hidden"></div>

      <div id="detailView" class="detail hidden" aria-live="polite"></div>
    </div>
	 <br><br>
  <p style="text-align: center;"><b>Spracovala pomocou UI:</b> Mgr. Erika Matyiová (2025)</p>
  <br><br>
  </div>

  <script>
    // KONFIGURÁCIA PODĽA OBRÁZKA
    // Riadky: 1 až 10
    const ROW_MIN = 1;
    const ROW_MAX = 10;
    // Stĺpce: 11 až 20
    const COL_MIN = 11;
    const COL_MAX = 20;

    const table = document.getElementById('multTable');
    const exampleBox = document.getElementById('exampleBox');
    const feedback = document.getElementById('feedback');
    const startBtn = document.getElementById('startBtn');
    const finishBtn = document.getElementById('finishBtn');
    const evaluateBtn = document.getElementById('evaluateBtn');
    const detailBtn = document.getElementById('detailBtn');
    const printBtn = document.getElementById('printBtn');
    const endControls = document.getElementById('endControls');
    const scoreBox = document.getElementById('scoreBox');
    const detailView = document.getElementById('detailView');

    let tasks = [];
    let currentIndex = -1;
    let studentName = '';
    let totalTasks = 20;

    function buildTable(){
      table.innerHTML = '';
      
      // 1. HLAVIČKA (Stĺpce 11-20)
      const thead = document.createElement('thead');
      const headRow = document.createElement('tr');
      const cornerTh = document.createElement('th'); 
      cornerTh.className = 'corner';
      headRow.appendChild(cornerTh); // Prázdny roh
      
      for(let c=COL_MIN; c<=COL_MAX; c++){
        const th = document.createElement('th');
        th.textContent = c;
        headRow.appendChild(th);
      }
      thead.appendChild(headRow);
      table.appendChild(thead);

      // 2. TELO (Riadky 1-10)
      const tbody = document.createElement('tbody');
      for(let r=ROW_MIN; r<=ROW_MAX; r++){
        const tr = document.createElement('tr');
        
        // Hlavička riadku (1-10)
        const th = document.createElement('th');
        th.textContent = r;
        tr.appendChild(th);

        // Bunky (výpočet)
        for(let c=COL_MIN; c<=COL_MAX; c++){
          const val = r * c;
          const td = document.createElement('td');
          td.className = 'cell';
          td.dataset.row = r;
          td.dataset.col = c;
          td.dataset.value = val;
          td.textContent = val;
          td.addEventListener('click', onCellClick);
          tr.appendChild(td);
        }
        tbody.appendChild(tr);
      }
      table.appendChild(tbody);
    }

    function generateTasks(n){
      // Počet možných kombinácií (10 riadkov * 10 stĺpcov = 100)
      const maxCombos = (ROW_MAX - ROW_MIN + 1) * (COL_MAX - COL_MIN + 1);
      const limit = Math.min(n, maxCombos);
      const used = new Set();
      const arr = [];
      
      while(arr.length < limit){
        // Náhodný riadok (1-10)
        const a = Math.floor(Math.random() * (ROW_MAX - ROW_MIN + 1)) + ROW_MIN;
        // Náhodný stĺpec (11-20)
        const b = Math.floor(Math.random() * (COL_MAX - COL_MIN + 1)) + COL_MIN;
        
        const key = `${a},${b}`;
        if(used.has(key)) continue;
        used.add(key);
        
        arr.push({
          a: a, // Činiteľ 1 (riadok)
          b: b, // Činiteľ 2 (stĺpec)
          correctAnswer: a * b,
          studentAnswer: null,
          firstTryCorrect: false,
          attemptedWrong: false,
          attemptedWrongCell: false, // pre prípad "správny výsledok, zlá bunka"
          solved: false
        });
      }
      return arr;
    }

    function startExercise(){
      studentName = document.getElementById('studentName').value.trim() || 'Neznámy';
      totalTasks = parseInt(document.getElementById('taskCount').value,10) || 20;
      if(totalTasks < 1) totalTasks = 1;
      if(totalTasks > 100) totalTasks = 100;

      tasks = generateTasks(totalTasks);
      currentIndex = -1;
      scoreBox.classList.add('hidden');
      detailView.classList.add('hidden');
      endControls.classList.add('hidden');
      finishBtn.classList.remove('hidden');
      feedback.textContent = '';
      
      buildTable();
      clearCellHighlights();
      nextTask();
    }

    function nextTask(){
      currentIndex++;
      if(currentIndex >= tasks.length){
        finishExercise();
        return;
      }
      feedback.textContent = '';
      const t = tasks[currentIndex];
      // Zobrazenie: "Riadok x Stĺpec ="
      exampleBox.textContent = `${t.a} x ${t.b} =`;
    }

    function finishExercise(){
      exampleBox.textContent = 'Cvičenie ukončené';
      feedback.textContent = '';
      finishBtn.classList.add('hidden');
      endControls.classList.remove('hidden');
      scoreBox.classList.add('hidden');
      printBtn.classList.remove('hidden');
    }

    function onCellClick(e){
      const td = e.currentTarget;
      const row = parseInt(td.dataset.row,10);
      const col = parseInt(td.dataset.col,10);
      const val = parseInt(td.dataset.value,10);
      
      if(currentIndex < 0 || currentIndex >= tasks.length) return;
      const t = tasks[currentIndex];
      if(t.solved) return;

      // Kontrola presnej súradnice (Riadok a Stĺpec)
      if(row === t.a && col === t.b){
        td.classList.add('correct');
        feedback.textContent = '';
        if(!t.attemptedWrong){
          t.firstTryCorrect = true;
        }
        t.studentAnswer = val;
        t.solved = true;

        setTimeout(() => {
          if(currentIndex === tasks.length -1){
            finishExercise();
          } else {
            nextTask();
          }
        }, 700);
      } else {
        // Nesprávna bunka
        t.studentAnswer = val;
        t.attemptedWrong = true;
        
        if(val === t.correctAnswer){
          // Správna hodnota, ale zlá bunka (napr. 6x20 vs 10x12)
          feedback.className = 'message warn';
          feedback.textContent = `Výsledok ${val} je správny, ale toto je políčko pre ${row} x ${col}. Hľadaj ${t.a} x ${t.b}.`;
          t.attemptedWrongCell = true;
        } else {
          // Úplne zlá hodnota
          feedback.className = 'message error';
          feedback.textContent = 'Nesprávne. Skús to prosím znova.';
        }
      }
    }

    function clearCellHighlights(){
      const cells = table.querySelectorAll('td.cell');
      cells.forEach(c => c.classList.remove('correct'));
    }

    function evaluate(){
      const correctFirstTry = tasks.filter(t => t.firstTryCorrect).length;
      const points = correctFirstTry;
      const percent = Math.round((points / tasks.length) * 100);
      scoreBox.classList.remove('hidden');
      scoreBox.innerHTML = `<strong>Výsledok:</strong> ${points} / ${tasks.length} bodov — <strong>${percent}%</strong>`;
    }

    function showDetail(){
      const now = new Date();
      const dateStr = now.toLocaleString('sk-SK');
      const correctFirstTry = tasks.filter(t => t.firstTryCorrect).length;
      const percent = Math.round((correctFirstTry / tasks.length) * 100);

      let html = '';
      html += `<h2>Detailný prehľad</h2>`;
      html += `<table class="report">`;
      html += `<tr><th>Názov cvičenia</th><td>Veľká násobilka (1-10 x 11-20)</td></tr>`;
      html += `<tr><th>Meno žiaka</th><td>${escapeHtml(studentName)}</td></tr>`;
      html += `<tr><th>Počet úloh</th><td>${tasks.length}</td></tr>`;
      html += `<tr><th>Bodové hodnotenie</th><td>${correctFirstTry} / ${tasks.length}</td></tr>`;
      html += `<tr><th>Percentuálne hodnotenie</th><td>${percent}%</td></tr>`;
      html += `<tr><th>Dátum a čas</th><td>${dateStr}</td></tr>`;
      html += `</table>`;

      html += `<h3 style="margin-top:12px;">Detail výsledkov</h3>`;
      html += `<table class="report"><thead><tr><th>Príklad</th><th>Správna odpoveď</th><th>Odpoveď žiaka</th><th>Stav</th><th>Komentár</th></tr></thead><tbody>`;
      tasks.forEach((t) => {
        const example = `${t.a} x ${t.b}`;
        const correct = t.correctAnswer;
        const student = (t.studentAnswer === null) ? '—' : t.studentAnswer;
        const ok = (t.firstTryCorrect) ? '✓' : '✗';
        const statusClass = (t.firstTryCorrect) ? 'ok' : 'bad';
        let comment = '';
        
        if(t.attemptedWrongCell){
          comment = 'Žiak našiel správny číselný výsledok, ale v nesprávnej bunke (zlá kombinácia činiteľov).';
        } else if(t.attemptedWrong && !t.firstTryCorrect){
          comment = 'Úloha vyriešená po chybe; bod sa nepripočítava.';
        } else if(!t.solved){
          comment = 'Úloha nebola dokončená.';
        }
        
        html += `<tr><td>${example}</td><td>${correct}</td><td>${student}</td><td class="${statusClass}">${ok}</td><td>${escapeHtml(comment)}</td></tr>`;
      });
      html += `</tbody></table>`;
      html += `<div class="legend"><strong>Vysvetlivky:</strong> <span class="ok">✓ správne na prvýkrát</span>; <span class="bad">✗ nesprávne alebo nie na prvýkrát</span></div>`;

      detailView.innerHTML = html;
      detailView.classList.remove('hidden');
      detailView.scrollIntoView({behavior: 'smooth'});
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]; });
    }

    // Tlač cez Ctrl+P
    window.addEventListener('keydown', function(e){
      const isPrintShortcut = (e.key && (e.key.toLowerCase() === 'p')) && (e.ctrlKey || e.metaKey);
      if(isPrintShortcut){
        if(!detailView.classList.contains('hidden')){
          e.preventDefault();
          setTimeout(() => window.print(), 50);
        }
      }
    });
    
    // Tlač cez tlačidlo
    printBtn.addEventListener('click', function(){
      if(!detailView.classList.contains('hidden')){
        window.print();
      }
    });

    startBtn.addEventListener('click', startExercise);
    finishBtn.addEventListener('click', () => { finishExercise(); });
    evaluateBtn.addEventListener('click', evaluate);
    detailBtn.addEventListener('click', showDetail);

    buildTable();
    document.getElementById('taskCount').addEventListener('keydown', (e)=>{ if(e.key === 'Enter') startExercise(); });
    document.getElementById('studentName').addEventListener('keydown', (e)=>{ if(e.key === 'Enter') startExercise(); });
  </script>

</body>
</html>