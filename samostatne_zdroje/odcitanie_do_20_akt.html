<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Odčítanie s výsledkom do 20</title>
    <style>
        /* Základné štýly stránky */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f8ff; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        h1 { color: #333; }

        /* Kontajner pre nastavenia a súhrn */
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 600px;
            width: 100%;
        }

        /* Štýly pre úvodnú obrazovku */
        .input-group { margin: 15px 0; text-align: left; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="number"].setup-input {
            width: 100%; padding: 10px; font-size: 16px;
            border: 2px solid #ddd; border-radius: 5px; box-sizing: border-box;
        }
        button {
            background-color: #4CAF50; color: white; padding: 12px 24px;
            border: none; border-radius: 5px; font-size: 18px; cursor: pointer;
            transition: background 0.3s; margin-top: 10px;
        }
        button:hover { background-color: #45a049; }
        button.secondary { background-color: #2196F3; }
        button.secondary:hover { background-color: #0b7dda; }

        /* --- Obrazovka cvičenia --- */
        #exercise-screen {
            display: none;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .exercise-container {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 50px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 20px;
        }

        .question-box {
            font-size: 80px; 
            font-weight: bold;
            display: flex;
            align-items: center;
            white-space: nowrap;
            line-height: 1;
        }

        .answer-input {
            font-size: 80px !important; 
            width: 140px;  
            height: 100px;
            text-align: center;
            border: none;
            border-bottom: 6px solid #333;
            margin-left: 15px;
            background: transparent;
            font-weight: bold;
            color: #000;
            padding: 0;
            line-height: 100px;
            font-family: inherit;
            border-radius: 10px;
            transition: background-color 0.3s;
        }
        .answer-input:focus { outline: none; border-bottom-color: #2196F3; }
        
        .answer-input::-webkit-outer-spin-button, .answer-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .answer-input { -moz-appearance: textfield; }

        .correct-bg { background-color: #b2dcb4 !important; color: black !important; border-bottom-color: transparent !important; }
        .incorrect-bg { background-color: #f8b5b4 !important; color: black !important; border-bottom-color: transparent !important; }

        /* --- Klávesnica --- */
        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            min-width: 250px;
        }

        .key {
            padding: 15px;
            font-size: 1.8em;
            font-weight: bold;
            background-color: #d0d0d0;
            color: #000000;
            border: 2px solid #999;
            border-radius: 8px;
            cursor: pointer;
            user-select: none;
            transition: all 0.1s;
        }
        .key:hover { background-color: #c0c0c0; }
        .key:active { background-color: #a0a0a0; transform: translateY(2px); }

        .key-enter { background-color: #4CAF50; color: white; grid-column: span 3; border-color: #388E3C; }
        .key-enter:hover { background-color: #45a049; }
        .key-backspace { background-color: #ff9800; color: white; border-color: #F57C00; font-size: 1.5em;}
        .key-backspace:hover { background-color: #fb8c00; }
        .key-clear { background-color: #f44336; color: white; border-color: #D32F2F; }
        .key-clear:hover { background-color: #e53935; }

        /* --- Obrazovka súhrnu --- */
        #summary-screen { display: none; text-align: left; }
        .summary-item { margin: 10px 0; font-size: 1.2em; border-bottom: 1px solid #eee; padding-bottom: 5px; }
    </style>
</head>
<body>

    <div class="container" id="setup-screen">
        <h1>Odčítanie s výsledkom do 20</h1>
        <div class="input-group">
            <label for="student-name">Meno žiaka:</label>
            <input type="text" id="student-name" placeholder="Zadajte meno">
        </div>
        <div class="input-group">
            <label for="question-count">Počet príkladov:</label>
            <input type="number" class="setup-input" id="question-count" value="10" min="1" max="50">
        </div>
        <button onclick="startExercise()">Spustiť cvičenie</button>
    </div>

    <div id="exercise-screen" style="display: none;">
        <div class="exercise-container">
            <div class="question-box">
                <span id="question-text">5 - 2 =</span>
                <input type="number" id="user-answer" class="answer-input" autocomplete="off">
            </div>
            
            <div class="keypad">
                <button class="key" onclick="addNumber(1)">1</button>
                <button class="key" onclick="addNumber(2)">2</button>
                <button class="key" onclick="addNumber(3)">3</button>
                <button class="key" onclick="addNumber(4)">4</button>
                <button class="key" onclick="addNumber(5)">5</button>
                <button class="key" onclick="addNumber(6)">6</button>
                <button class="key" onclick="addNumber(7)">7</button>
                <button class="key" onclick="addNumber(8)">8</button>
                <button class="key" onclick="addNumber(9)">9</button>
                <button class="key key-backspace" onclick="backspace()">⌫</button>
                <button class="key" onclick="addNumber(0)">0</button>
                <button class="key key-clear" onclick="clearInput()">C</button>
                <button class="key key-enter" onclick="checkAnswer()">Enter</button>
            </div>
        </div>
    </div>

    <div class="container" id="summary-screen">
        <h1>Celkové vyhodnotenie</h1>
        <div class="summary-item"><strong>Názov cvičenia:</strong> Odčítanie do 20</div>
        <div class="summary-item"><strong>Meno žiaka:</strong> <span id="summary-name"></span></div>
        <div class="summary-item"><strong>Hodnotenie:</strong> <span id="summary-score"></span></div>
        <div class="summary-item"><strong>Dátum a čas:</strong> <span id="summary-date"></span></div>
        
        <div style="text-align: center; margin-top: 20px;">
            <button class="secondary" onclick="showDetails()">Detailné výsledky</button>
            <br>
            <button onclick="location.reload()" style="margin-top: 10px; background-color: #666;">Nové cvičenie</button>
        </div>
    </div>

    <script>
        // DATABÁZA PRÍKLADOV NA ODČÍTANIE
        const rawDatabase = [
            "1 - 0 = 1", "2 - 1 = 1", "3 - 2 = 1", "4 - 3 = 1", "5 - 4 = 1", "6 - 5 = 1", "7 - 6 = 1", "8 - 7 = 1", "9 - 8 = 1", "10 - 9 = 1", "11 - 10 = 1", "12 - 11 = 1", "13 - 12 = 1", "14 - 13 = 1", "15 - 14 = 1", "16 - 15 = 1", "17 - 16 = 1", "18 - 17 = 1", "19 - 18 = 1", "20 - 19 = 1",
            "3 - 1 = 2", "4 - 2 = 2", "5 - 3 = 2", "6 - 4 = 2", "7 - 5 = 2", "8 - 6 = 2", "9 - 7 = 2", "10 - 8 = 2", "11 - 9 = 2", "12 - 10 = 2", "13 - 11 = 2", "14 - 12 = 2", "15 - 13 = 2", "16 - 14 = 2", "17 - 15 = 2", "18 - 16 = 2", "19 - 17 = 2", "20 - 18 = 2",
            "4 - 1 = 3", "5 - 2 = 3", "6 - 3 = 3", "7 - 4 = 3", "8 - 5 = 3", "9 - 6 = 3", "10 - 7 = 3", "11 - 8 = 3", "12 - 9 = 3", "13 - 10 = 3", "14 - 11 = 3", "15 - 12 = 3", "16 - 13 = 3", "17 - 14 = 3", "18 - 15 = 3", "19 - 16 = 3", "20 - 17 = 3",
            "5 - 1 = 4", "6 - 2 = 4", "7 - 3 = 4", "8 - 4 = 4", "9 - 5 = 4", "10 - 6 = 4", "11 - 7 = 4", "12 - 8 = 4", "13 - 9 = 4", "14 - 10 = 4", "15 - 11 = 4", "16 - 12 = 4", "17 - 13 = 4", "18 - 14 = 4", "19 - 15 = 4", "20 - 16 = 4",
            "6 - 1 = 5", "7 - 2 = 5", "8 - 3 = 5", "9 - 4 = 5", "10 - 5 = 5", "11 - 6 = 5", "12 - 7 = 5", "13 - 8 = 5", "14 - 9 = 5", "15 - 10 = 5", "16 - 11 = 5", "17 - 12 = 5", "18 - 13 = 5", "19 - 14 = 5", "20 - 15 = 5",
            "7 - 1 = 6", "8 - 2 = 6", "9 - 3 = 6", "10 - 4 = 6", "11 - 5 = 6", "12 - 6 = 6", "13 - 7 = 6", "14 - 8 = 6", "15 - 9 = 6", "16 - 10 = 6", "17 - 11 = 6", "18 - 12 = 6", "19 - 13 = 6", "20 - 14 = 6",
            "8 - 1 = 7", "9 - 2 = 7", "10 - 3 = 7", "11 - 4 = 7", "12 - 5 = 7", "13 - 6 = 7", "14 - 7 = 7", "15 - 8 = 7", "16 - 9 = 7", "17 - 10 = 7", "18 - 11 = 7", "19 - 12 = 7", "20 - 13 = 7",
            "9 - 1 = 8", "10 - 2 = 8", "11 - 3 = 8", "12 - 4 = 8", "13 - 5 = 8", "14 - 6 = 8", "15 - 7 = 8", "16 - 8 = 8", "17 - 9 = 8", "18 - 10 = 8", "19 - 11 = 8", "20 - 12 = 8",
            "10 - 1 = 9", "11 - 2 = 9", "12 - 3 = 9", "13 - 4 = 9", "14 - 5 = 9", "15 - 6 = 9", "16 - 7 = 9", "17 - 8 = 9", "18 - 9 = 9", "19 - 10 = 9", "20 - 11 = 9",
            "11 - 1 = 10", "12 - 2 = 10", "13 - 3 = 10", "14 - 4 = 10", "15 - 5 = 10", "16 - 6 = 10", "17 - 7 = 10", "18 - 8 = 10", "19 - 9 = 10", "20 - 10 = 10",
            "12 - 1 = 11", "13 - 2 = 11", "14 - 3 = 11", "15 - 4 = 11", "16 - 5 = 11", "17 - 6 = 11", "18 - 7 = 11", "19 - 8 = 11", "20 - 9 = 11",
            "13 - 1 = 12", "14 - 2 = 12", "15 - 3 = 12", "16 - 4 = 12", "17 - 5 = 12", "18 - 6 = 12", "19 - 7 = 12", "20 - 8 = 12",
            "14 - 1 = 13", "15 - 2 = 13", "16 - 3 = 13", "17 - 4 = 13", "18 - 5 = 13", "19 - 6 = 13", "20 - 7 = 13",
            "15 - 1 = 14", "16 - 2 = 14", "17 - 3 = 14", "18 - 4 = 14", "19 - 5 = 14", "20 - 6 = 14",
            "16 - 1 = 15", "17 - 2 = 15", "18 - 3 = 15", "19 - 4 = 15", "20 - 5 = 15",
            "17 - 1 = 16", "18 - 2 = 16", "19 - 3 = 16", "20 - 4 = 16",
            "18 - 1 = 17", "19 - 2 = 17", "20 - 3 = 17",
            "19 - 1 = 18", "20 - 2 = 18",
            "20 - 1 = 19",
            "20 - 0 = 20"
        ];

        let questions = [];
        let currentQuestionIndex = 0;
        let totalQuestions = 0;
        let studentName = "";
        let score = 0;
        let currentAttempts = [];
        let allResults = [];
        let firstTry = true;

        function parseDatabase() {
            return rawDatabase.map(item => {
                const parts = item.split('=');
                return {
                    text: parts[0].trim() + " =",
                    correct: parseInt(parts[1].trim())
                };
            });
        }

        const questionDB = parseDatabase();

        function startExercise() {
            const nameInput = document.getElementById('student-name').value.trim();
            studentName = nameInput !== "" ? nameInput : "XY";
            
            const countInput = document.getElementById('question-count').value;
            totalQuestions = parseInt(countInput);
            
            if (isNaN(totalQuestions) || totalQuestions < 1) {
                alert("Zadajte platný počet príkladov.");
                return;
            }

            // --- Miešanie príkladov bez opakovania ---
            let tempDB = [...questionDB];
            for (let i = tempDB.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [tempDB[i], tempDB[j]] = [tempDB[j], tempDB[i]];
            }

            const actualCount = Math.min(totalQuestions, tempDB.length);
            totalQuestions = actualCount; 
            questions = tempDB.slice(0, actualCount);

            currentQuestionIndex = 0;
            score = 0;
            allResults = [];

            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('exercise-screen').style.display = 'flex';
            
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestionIndex >= totalQuestions) {
                finishExercise();
                return;
            }

            const q = questions[currentQuestionIndex];
            document.getElementById('question-text').innerText = q.text;
            const input = document.getElementById('user-answer');
            input.value = "";
            input.classList.remove('correct-bg', 'incorrect-bg');
            input.focus();
            
            currentAttempts = [];
            firstTry = true;
        }

        function resetInputColor() {
            const input = document.getElementById('user-answer');
            input.classList.remove('incorrect-bg');
        }

        function addNumber(num) {
            resetInputColor();
            const input = document.getElementById('user-answer');
            input.value += num;
            input.focus();
        }

        function backspace() {
            resetInputColor();
            const input = document.getElementById('user-answer');
            input.value = input.value.slice(0, -1);
            input.focus();
        }

        function clearInput() {
            resetInputColor();
            const input = document.getElementById('user-answer');
            input.value = "";
            input.focus();
        }

        function checkAnswer() {
            const input = document.getElementById('user-answer');
            const answer = parseInt(input.value);
            const currentQ = questions[currentQuestionIndex];
            
            if (isNaN(answer)) return;

            if (answer === currentQ.correct) {
                input.classList.remove('incorrect-bg');
                input.classList.add('correct-bg');
                currentAttempts.push({ val: answer, correct: true });
                if (firstTry) score++;

                allResults.push({
                    question: currentQ.text + " " + currentQ.correct,
                    attempts: [...currentAttempts]
                });

                setTimeout(() => {
                    input.classList.remove('correct-bg');
                    currentQuestionIndex++;
                    loadQuestion();
                }, 1000);

            } else {
                input.classList.remove('correct-bg');
                input.classList.add('incorrect-bg');
                currentAttempts.push({ val: answer, correct: false });
                firstTry = false;
                input.focus();
            }
        }

        function finishExercise() {
            document.getElementById('exercise-screen').style.display = 'none';
            document.getElementById('summary-screen').style.display = 'block';

            const percentage = Math.round((score / totalQuestions) * 100);
            const now = new Date();
            const dateStr = now.toLocaleDateString('sk-SK') + " " + now.toLocaleTimeString('sk-SK');

            document.getElementById('summary-name').innerText = studentName;
            document.getElementById('summary-score').innerText = `${score} z ${totalQuestions} (${percentage}%)`;
            document.getElementById('summary-date').innerText = dateStr;
        }

        function showDetails() {
            const percentage = Math.round((score / totalQuestions) * 100);
            const now = new Date();
            const dateStr = now.toLocaleDateString('sk-SK') + " " + now.toLocaleTimeString('sk-SK');

            let tableRows = "";
            allResults.forEach(res => {
                let attemptsHtml = res.attempts.map(att => {
                    return `${att.val} <span style="color:${att.correct ? 'green' : 'red'}">${att.correct ? '&#10004;' : '&#10008;'}</span>`;
                }).join(", ");
                tableRows += `<tr><td>${res.question}</td><td>${attemptsHtml}</td></tr>`;
            });

            const htmlContent = `
                <!DOCTYPE html>
                <html lang="sk">
                <head>
                    <title>Výsledky - ${studentName}</title>
                    <style>
                        body { font-family: sans-serif; padding: 20px; }
                        h1 { color: #333; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                    </style>
                </head>
                <body>
                    <h1>Detailný prehľad: Odčítanie do 20</h1>
                    <p><strong>Žiak:</strong> ${studentName}</p>
                    <p><strong>Úspešnosť:</strong> ${score} z ${totalQuestions} (${percentage}%)</p>
                    <p><strong>Dátum:</strong> ${dateStr}</p>
                    <table>
                        <thead><tr><th>Príklad</th><th>Pokusy</th></tr></thead>
                        <tbody>${tableRows}</tbody>
                    </table>
                    <button onclick=\"window.print()\" style=\"margin-top:20px; padding:10px 20px;\">Tlačiť</button>
                </body>
                </html>
            `;
            const win = window.open("", "_blank");
            win.document.write(htmlContent);
            win.document.close();
        }

        document.addEventListener('keydown', function(event) {
            if (document.getElementById('exercise-screen').style.display !== 'none') {
                const input = document.getElementById('user-answer');
                input.focus();
                if (!isNaN(parseInt(event.key)) || event.key === "Backspace" || event.key === "Delete") {
                    resetInputColor();
                }
                if (event.key === "Enter") {
                    event.preventDefault();
                    checkAnswer();
                }
            }
        });
    </script>
    <br><br>
    <div style="text-align: center; color: #777;">
        <b>Spracovala pomocou UI:</b> Mgr. Erika Matyiová (2026)
    </div>
</body>
</html>