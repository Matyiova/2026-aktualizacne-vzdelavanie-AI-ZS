<!doctype html>
<html lang="sk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Malá násobilka - doplňovanie</title>
  <style>
    :root{
      --bg:#f7f7f7;
      --panel:#ffffff;
      --accent:#2b7a2b; /* Zelená pre malú násobilku */
      --error:#c62828;
      --muted:#dcdcdc;
      --cell-border:#888;
      --header-bg:#e0e0e0;
    }
    html,body{height:100%;margin:0;background:var(--bg);font-family:monospace;}
    .container{
      max-width:1200px;
      margin:18px auto;
      padding:14px;
      background:var(--panel);
      box-shadow:0 6px 18px rgba(0,0,0,0.06);
      border-radius:8px;
    }
    .top-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:center;}
    label{font-weight:700;font-size:14px;}
    input[type="text"], input[type="number"]{
      font-family:monospace;padding:6px 8px;border:1px solid #ccc;border-radius:4px;font-size:14px;
    }
    
    .main-game-area {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        gap: 20px;
        margin-top: 20px;
        flex-wrap: wrap;
    }

    input.cell-input {
        width: 100%; height: 100%; border: none; text-align: center;
        font-family: monospace; font-size: 20px; font-weight: 700;
        outline: 2px solid var(--accent); background: #e8f5e9; padding: 0;
    }
    input.cell-input::-webkit-outer-spin-button,
    input.cell-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

    button{font-family:monospace;padding:7px 10px;border-radius:6px;border:1px solid #888;background:#fff;cursor:pointer;font-size:14px;}
    button.primary{background:var(--accent);color:#fff;border-color:rgba(0,0,0,0.08);}
    .center{text-align:center;}
    h1{margin:6px 0; font-size: 24px;}
    .example{ font-size: 40px; font-weight:700; margin: 10px 0;}
    .message{ min-height: 20px; margin-bottom: 10px; font-weight: 700; }
    .message.error{ color: var(--error); }
    .message.warn{ color: #b36b00; }

    table.mtable{ border-collapse: collapse; }
    table.mtable th, table.mtable td{
      border:1px solid var(--cell-border);
      width:44px; height:44px; text-align:center; padding:0;
    }
    table.mtable th{background:var(--header-bg); font-size:18px;}
    table.mtable td.cell{ cursor:pointer; background:#fff; font-size:20px; font-weight:700; position: relative;}
    td.correct{background:#c8e6c9 !important; cursor: default !important;}

    /* Virtuálna klávesnica */
    .numpad {
        display: grid;
        grid-template-columns: repeat(3, 60px);
        gap: 8px;
        background: #eee;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
        user-select: none;
    }
    .numpad button {
        height: 50px;
        font-size: 20px;
        font-weight: bold;
        background: #fff;
    }
    .numpad button:active { background: #ddd; }
    .numpad .btn-enter { grid-column: span 2; background: var(--accent); color: #fff; }
    .numpad .btn-back { background: #fbe9e7; color: var(--error); }

    .hidden{display:none;}
    .summary{margin-top:12px;padding:10px;border:1px dashed #ccc;background:#fafafa;}
    
    /* DETAIL VIEW & REPORT STYLES */
    .detail{margin-top:12px; text-align: left;}
    .report-header { border-bottom: 2px solid #ccc; margin-bottom: 15px; padding-bottom: 10px; }
    .report-header h2 { margin: 0 0 10px 0; }
    .report-meta { display: flex; justify-content: space-between; flex-wrap: wrap; gap: 10px; font-size: 16px; }
    
    table.report{width:100%;border-collapse:collapse;font-size:14px;}
    table.report th, table.report td{border:1px solid #ddd;padding:8px; text-align: center;}
    table.report th { background: #eee; }

    @media (max-width:800px){
      .main-game-area { flex-direction: column; align-items: center; }
      table.mtable th, table.mtable td{width:36px;height:36px;font-size:14px;}
      .report-meta { flex-direction: column; }
    }

    /* TLAČ (CTRL+P) */
    @media print {
      body { background: #fff; color: #000; }
      .container { box-shadow: none; margin: 0; padding: 0; max-width: none; border: none; }
      
      /* Skryť všetko okrem detailného reportu */
      .top-row, .controls, #endControls, #scoreBox, .main-game-area, h1, #exampleBox, #feedback, button {
        display: none !important;
      }
      
      /* Zobraziť report, aj keď bol skrytý */
      #detailView { 
        display: block !important; 
        position: static;
        width: 100%;
        margin: 0;
        padding: 0;
        visibility: visible !important;
      }
      
      .report-header h2 { font-size: 24px; text-align: center; }
      table.report th, table.report td { border: 1px solid #000 !important; }
      table.report { width: 100%; }
      
      /* Ochrana pred rozdelením riadkov tabuľky */
      tr { page-break-inside: avoid; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="top-row">
      <div>
        <label>Meno</label><br /><input id="studentName" type="text" />
      </div>
      <div>
        <label>Úlohy</label><br /><input id="taskCount" type="number" value="20" />
      </div>
      <div style="align-self:end;"><button id="startBtn" class="primary">Štart</button></div>
    </div>

    <div class="center">
      <h1>Malá násobilka - doplňovanie</h1>
      <div id="exampleBox" class="example">— x — = ?</div>
      <div id="feedback" class="message"></div>

      <div class="main-game-area">
        <div class="grid-wrap">
          <table class="mtable" id="multTable"></table>
        </div>

        <div id="keyboardArea" class="hidden">
          <div class="numpad">
            <button onclick="numClick(7)">7</button><button onclick="numClick(8)">8</button><button onclick="numClick(9)">9</button>
            <button onclick="numClick(4)">4</button><button onclick="numClick(5)">5</button><button onclick="numClick(6)">6</button>
            <button onclick="numClick(1)">1</button><button onclick="numClick(2)">2</button><button onclick="numClick(3)">3</button>
            <button class="btn-back" onclick="numClick('back')">←</button><button onclick="numClick(0)">0</button><button class="btn-enter" onclick="numClick('enter')">ENTER</button>
          </div>
        </div>
      </div>
<br>
      <div class="controls"><button id="finishBtn" class="hidden">Koniec</button></div>
	  <br>
      <div id="endControls" class="hidden">
        <button id="evaluateBtn">Hodnotiť</button> <button id="detailBtn">Detail</button>
      </div>
      <div id="scoreBox" class="summary hidden"></div>
      <div id="detailView" class="detail hidden"></div>
	  <br><br>
  <b>Spracovala pomocou UI:</b> Mgr. Erika Matyiová (2025)
    </div>
  </div>

  <script>
    const MAX_FACTOR = 10;
    let tasks = [], currentIndex = -1, studentName = '', activeInput = null;

    function buildTable(){
      const table = document.getElementById('multTable');
      table.innerHTML = '';
      let head = '<thead><tr><th class="corner"></th>';
      for(let c=1;c<=MAX_FACTOR;c++) head += `<th>${c}</th>`;
      table.innerHTML = head + '</tr></thead>';
      let body = '<tbody>';
      for(let r=1;r<=MAX_FACTOR;r++){
        body += `<tr><th>${r}</th>`;
        for(let c=1;c<=MAX_FACTOR;c++) body += `<td class="cell" data-row="${r}" data-col="${c}"></td>`;
        body += '</tr>';
      }
      table.innerHTML += body + '</tbody>';
      table.querySelectorAll('.cell').forEach(td => td.addEventListener('click', onCellClick));
    }

    function startExercise(){
      studentName = document.getElementById('studentName').value || 'Žiak';
      const n = parseInt(document.getElementById('taskCount').value) || 20;
      tasks = generateTasks(n);
      currentIndex = -1;
      document.getElementById('keyboardArea').classList.remove('hidden');
      document.getElementById('finishBtn').classList.remove('hidden');
      document.getElementById('scoreBox').classList.add('hidden');
      document.getElementById('detailView').classList.add('hidden');
      document.getElementById('endControls').classList.add('hidden');
      buildTable(); nextTask();
    }

    function generateTasks(n){
      let arr = [], used = new Set();
      let limit = Math.min(n, 100);
      while(arr.length < limit){
        let a = Math.floor(Math.random()*MAX_FACTOR)+1;
        let b = Math.floor(Math.random()*MAX_FACTOR)+1;
        if(used.has(`${a},${b}`)) continue;
        used.add(`${a},${b}`);
        // UPRAVENÉ: Pridané pole userAnswers
        arr.push({a, b, correctAnswer: a*b, solved:false, firstTryCorrect:false, attemptedWrong:false, userAnswers: []});
      }
      return arr;
    }

    function nextTask(){
      currentIndex++;
      if(currentIndex >= tasks.length) return finishExercise();
      document.getElementById('exampleBox').textContent = `${tasks[currentIndex].a} x ${tasks[currentIndex].b} = ?`;
      document.getElementById('feedback').textContent = '';
    }

    function onCellClick(e){
      if(currentIndex < 0 || tasks[currentIndex].solved) return;
      const td = e.currentTarget;
      if(td.classList.contains('correct')) return;
      
      // Vyčisti iný aktívny vstup
      document.querySelectorAll('.cell-input').forEach(i => i.parentElement.innerHTML = '');
      
      const input = document.createElement('input');
      input.type = 'number'; input.className = 'cell-input';
      td.appendChild(input); input.focus(); activeInput = input;
      
      input.addEventListener('keydown', (evt) => { if(evt.key === 'Enter') evaluateInput(td, input.value); });
    }

    function numClick(val){
      if(!activeInput) return;
      if(val === 'enter') evaluateInput(activeInput.parentElement, activeInput.value);
      else if(val === 'back') activeInput.value = activeInput.value.slice(0, -1);
      else activeInput.value += val;
      activeInput.focus();
    }

    function evaluateInput(td, valStr){
      const val = parseInt(valStr), t = tasks[currentIndex];
      const r = parseInt(td.dataset.row), c = parseInt(td.dataset.col);
      if(isNaN(val)) return;

      // UPRAVENÉ: Uložíme si odpoveď žiaka (aj zlú)
      t.userAnswers.push(val);

      if(r === t.a && c === t.b && val === t.correctAnswer){
        td.innerHTML = val; td.classList.add('correct'); activeInput = null;
        if(!t.attemptedWrong) t.firstTryCorrect = true;
        t.solved = true; 
        setTimeout(nextTask, 500);
      } else {
        t.attemptedWrong = true;
        const msg = document.getElementById('feedback');
        if (val === t.correctAnswer) {
            msg.textContent = 'Správny výsledok, zlá bunka!';
            msg.className = 'message warn';
        } else {
            msg.textContent = 'Nesprávne!';
            msg.className = 'message error';
        }
        td.innerHTML = ''; activeInput = null;
      }
    }

    function finishExercise(){
      document.getElementById('exampleBox').textContent = 'Koniec cvičenia.';
      document.getElementById('keyboardArea').classList.add('hidden');
      document.getElementById('finishBtn').classList.add('hidden');
      document.getElementById('endControls').classList.remove('hidden');
    }

    // Nová funkcia pre generovanie reportu pre tlač
    function generateDetailView() {
        const ok = tasks.filter(t=>t.firstTryCorrect).length;
        const percent = Math.round((ok / tasks.length) * 100);
        const title = 'Malá násobilka - dopisovanie'; 
        const dateStr = new Date().toLocaleString('sk-SK');
        
        let html = `
        <div class="report-header">
            <h2>Výsledný list: ${title}</h2>
            <div class="report-meta">
                <span><strong>Žiak:</strong> ${studentName}</span>
                <span><strong>Dátum:</strong> ${dateStr}</span>
                <span><strong>Hodnotenie:</strong> ${ok}/${tasks.length} bodov (${percent}%)</span>
            </div>
        </div>
        <table class="report">
            <tr>
                <th>Príklad</th>
                <th>Správna odpoveď</th>
                <th>Odpovede žiaka</th>
                <th>Stav</th>
            </tr>`;

        tasks.forEach(t => {
            const answersStr = t.userAnswers.length > 0 ? t.userAnswers.join(', ') : '-';
            html += `<tr>
                <td>${t.a} x ${t.b}</td>
                <td><strong>${t.correctAnswer}</strong></td>
                <td>${answersStr}</td>
                <td>${t.firstTryCorrect?'<span style="color:green">✓</span>':'<span style="color:red">✗</span>'}</td>
            </tr>`;
        });
        html += '</table>';
        
        document.getElementById('detailView').innerHTML = html;
    }

    document.getElementById('startBtn').addEventListener('click', startExercise);
    document.getElementById('finishBtn').addEventListener('click', finishExercise);
    
    document.getElementById('evaluateBtn').addEventListener('click', () => {
        const ok = tasks.filter(t=>t.firstTryCorrect).length;
        const percent = Math.round((ok / tasks.length) * 100);
        document.getElementById('scoreBox').innerHTML = `Výsledok: ${ok}/${tasks.length} bodov (${percent}%)`;
        document.getElementById('scoreBox').classList.remove('hidden');
        
        // Pred-generovanie detailu pre tlač
        generateDetailView(); 
    });
    
    // UPRAVENÉ: Volá novú funkciu pre detail a zobrazí report
    document.getElementById('detailBtn').addEventListener('click', () => {
        generateDetailView();
        document.getElementById('detailView').classList.remove('hidden');
    });

    buildTable();
  </script>
   
</body>
</html>