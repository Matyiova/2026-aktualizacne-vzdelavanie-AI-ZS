<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <title>Gener치tor testu s MC - PL (+ Rie코enia)</title>
  <style>
    /* Z치kladn칳 코t칳l str치nky */
    body { font-family: Courier bold, monospace; font-size: 100%; padding: 20px; max-width: 1100px; margin: 0 auto; line-height: 1.4; background-color: #fcfcfc; }
    h1, h2, h3 { color: #2c3e50; }
    
    .section-block { margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
    
    textarea { width: 100%; box-sizing: border-box; font-family: Courier bold, monospace; font-size: 120%; border: 1px solid #aaa; border-radius: 4px; padding: 8px; }
    input[type="text"], input[type="number"] { padding: 5px; border: 1px solid #aaa; border-radius: 4px; }
    select { padding: 5px; border: 1px solid #aaa; border-radius: 4px; }
    
    button { cursor: pointer; padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; font-size: 1rem; margin-right: 5px; margin-bottom: 5px; font-family: inherit; }
    button:hover { background-color: #0056b3; }

    /* RTF Sekcia */
    .rtf-settings { background-color: #e9ecef; padding: 15px; border-radius: 8px; border: 2px solid #dee2e6; margin-top: 10px; }
    .grade-table { border-collapse: collapse; width: 100%; max-width: 400px; margin-bottom: 10px; background: white; }
    .grade-table td, .grade-table th { border: 1px solid #999; padding: 5px; text-align: center; font-size: 0.9em; }
    .grade-table input { width: 50px; text-align: center; }
    
    .input-group { margin-bottom: 10px; }
    .input-group label { font-weight: bold; display: block; margin-bottom: 5px; }
  </style>
</head>
<body>

<h1>Gener치tor testu MC (na tla캜 + rie코enia)</h1>

<div class="section-block">
    <h2>1. Vstupn칠 칰daje</h2>
    <p style="font-size: 1.1em; color: #555;">
      Form치t: <span style="color: blue;">zadanie</span>[TAB]<span style="color: green;">spr치vna odpove캞</span>[TAB]<span style="color: darkred;">distraktor 1</span>[TAB]<span style="color: darkred;">distraktor 2</span>[TAB]<span style="color: darkred;">distraktor 3 (nepovinn칳)</span>
    </p>
    <textarea id="inputData" rows="12" placeholder="pojem[TAB]defin칤cia[TAB]distraktor 1[TAB]distraktor 2" spellcheck="false"></textarea>
    
    <div style="margin-top: 15px;">
      <b>N치zov s칰boru:</b><br>
      <input type="text" id="fileName" placeholder="Test_SK_slovicka" style="width: 60%;">
      <input type="text" id="testTitle" placeholder="Nadpis (napr. Test z Biol칩gie)" style="width: 60%; margin-top: 5px;">
    </div>
    
    <div style="margin-top: 10px;">
      <b>Po캜et ot치zok:</b> <input type="number" id="questionCount" min="1" value="16" style="width: 60px;">
    </div>
</div>

<div class="section-block">
    <h2>2. RTF Nastavenia (Pre tla캜)</h2>
    <div class="rtf-settings">
        <div class="input-group">
            <label>Po캜et variantov (skup칤n):</label>
            <input type="number" id="rtfVariants" min="1" max="10" value="2" style="width: 50px;">
        </div>
        
        <div class="input-group">
            <label>Rozlo쬰nie ot치zok (st컄pce):</label>
            <select id="rtfColumns">
                <option value="1">1 st컄pec (pod sebou)</option>
                <option value="2" selected>2 st컄pce</option>
                <option value="3">3 st컄pce</option>
            </select>
        </div>
        
        <div class="input-group">
            <label>Pokyny pre 쬴aka:</label>
            <textarea id="rtfInstructions" rows="3">Zakr칰쬶uj spr치vne rie코enie. Pri opravovan칤 zafarbi nespr치vne rie코enie a zakr칰쬶uj in칠 rie코enie, ktor칠 pova쬿je코 za spr치vne.</textarea>
        </div>
    </div>
</div>

<div class="rtf-settings" style="margin-top: 10px;">
    <div class="input-group">
        <label>Tabu쬶a hodnotenia:</label>
        <table class="grade-table">
                <tr><th>Zn치mka</th><th colspan="2">Po캜et percent</th></tr>
                <tr><td>1</td><td><input type="number" id="g1max" value="100"></td><td><input type="number" id="g1min" value="90"></td></tr>
                <tr><td>2</td><td><input type="number" id="g2max" value="89"></td><td><input type="number" id="g2min" value="75"></td></tr>
                <tr><td>3</td><td><input type="number" id="g3max" value="74"></td><td><input type="number" id="g3min" value="50"></td></tr>
                <tr><td>4</td><td><input type="number" id="g4max" value="49"></td><td><input type="number" id="g4min" value="30"></td></tr>
                <tr><td>5</td><td><input type="number" id="g5max" value="29"></td><td><input type="number" id="g5min" value="0"></td></tr>
        </table>
        <label><input type="checkbox" id="includeGradeTable" checked> Zobrazi콘 tabu쬶u</label>
    </div>
    <button onclick="generateRTF()" style="background-color: #6f42c1; font-weight: bold; color: white;">游늯 Stiahnu콘 Pracovn칳 list (.rtf)</button>
</div>

<script>
    /* --- SPOLO캛N칄 FUNKCIE --- */
    function shuffle(array) {
      const arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function parseInput() {
      const input = document.getElementById("inputData").value.trim();
      if(!input) return [];
      const lines = input.split("\n");
      const allQuestions = [];

      for (let line of lines) {
        const parts = line.split("\t");
        if (parts.length < 2) continue;

        const term = parts[0].trim();
        const correct = parts[1].trim();
        const distractors = parts.slice(2).map(d => d.trim()).filter(d => d !== "");
        
        allQuestions.push({ term, correct, distractors });
      }
      return allQuestions;
    }
    
    function normalizeFilename(text) {
        return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^a-zA-Z0-9-_ ]/g, "").replace(/\s+/g, "_");
    }

    /* --- RTF EXPORT --- */
    
    const CEE_CHAR_MAP = {
        '츼': "\\'c1", '치': "\\'e1", '캛': "\\'c8", '캜': "\\'e8", '캝': "\\'cf", '캞': "\\'ef", 
        '칄': "\\'c9", '칠': "\\'e9", '캨': "\\'cc", '캩': "\\'ec", '칈': "\\'cd", '칤': "\\'ed", 
        '컇': "\\'bd", '': "\\'be", '켾': "\\'d2", '켿': "\\'f2", '칍': "\\'d3", '칩': "\\'f3", 
        '콎': "\\'d8", '콏': "\\'f8", '': "\\'8a", '코': "\\'9a", '콗': "\\'8d", '콘': "\\'9d", 
        '칔': "\\'da", '칰': "\\'fa", '콡': "\\'d9", '콢': "\\'f9", '칗': "\\'dd", '칳': "\\'fd", 
        '콯': "\\'8e", '': "\\'9e", '츿': "\\'c4", '칛': "\\'e4", '칐': "\\'d6", '칬': "\\'f6", 
        '칖': "\\'dc", '칲': "\\'fc", '': "\\'df", '캕': "\\'c6", '캖': "\\'e6", 
        '콐': "\\'d3", '콑': "\\'f3", '': "\\'e0", '': "\\'c0", '칟': "\\'e8", '칃': "\\'c8", 
        '칡': "\\'ea", '칅': "\\'ca", '칞': "\\'e7", '칂': "\\'c7"
    };

    function toRTF(str) {
        if (!str) return "";
        let rtf = "";
        for (let i = 0; i < str.length; i++) {
            const char = str[i];
            if (CEE_CHAR_MAP[char]) {
                rtf += CEE_CHAR_MAP[char];
            } else if (['{', '}', '\\'].includes(char)) {
                rtf += '\\' + char;
            } else if (char === '\n') {
                rtf += '\\par ';
            } else if (char === '\t') {
                rtf += '\\tab ';
            } else {
                rtf += char;
            }
        }
        return rtf;
    }

    function generateRTF() {
        const allData = parseInput();
        if (allData.length === 0) { alert("콯iadne d치ta pre generovanie!"); return; }

        const title = document.getElementById("testTitle").value || "Test";
        const instructions = document.getElementById("rtfInstructions").value;
        const variantsCount = parseInt(document.getElementById("rtfVariants").value) || 1;
        const questionCount = parseInt(document.getElementById("questionCount").value) || allData.length;
        const columnsCount = parseInt(document.getElementById("rtfColumns").value) || 2;
        const includeTable = document.getElementById("includeGradeTable").checked;

        // HLAVI캛KA RTF
        let rtfContent = "{\\rtf1\\ansi\\ansicpg1250\\deff0\\nouicompat\\deflang1051";
        rtfContent += "{\\fonttbl{\\f0\\fnil\\fcharset238 Comic Sans MS;}{\\f1\\fnil\\fcharset238 Arial;}}";
        rtfContent += "\\viewkind4\\uc1\\pard\\sa100\\sl240\\slmult1\\f0\\fs22\\lang1051\\margl850\\margr850\\margt850\\margb850 ";

        const letters = ['a', 'b', 'c', 'd', 'e', 'f', 'g'];
        const groupNames = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        let variantHistory = [];

        // --- 1. 캛AS콗: GENERAVANIE TESTOV ---
        for (let v = 0; v < variantsCount; v++) {
            const groupQuestions = shuffle(allData).slice(0, questionCount);
            const currentGroupName = groupNames[v % groupNames.length] || (v+1);
            
            let currentVariantData = {
                name: currentGroupName,
                questions: []
            };

            // Jednost컄pcov치 hlavi캜ka
            rtfContent += `\\pard\\qj Meno: .......................................................................................  Trieda: ........................  ${toRTF("D치tum")}: .............................\\par\\par`;
            rtfContent += `\\pard\\qc\\b\\fs32 ${toRTF(title)} \\b0\\fs22\\par\\par`;
            rtfContent += `\\pard\\qc\\b\\fs28 ${toRTF("Skupina")} ${currentGroupName} \\b0\\fs22\\par\\par`;
            
            // Pokyny - ZMENA: namiesto \par\par na konci pou쮂셨ame \sa400 pre odsadenie
            // T칳m zabezpe캜칤me, 쬰 sekcia st컄pcov za캜ne 캜isto.
            rtfContent += `\\pard\\qj\\sa400 ${toRTF(instructions)}\\par`;
            
            // Nastavenie st컄pcov
            let colGap = 720;
            if(columnsCount >= 3) colGap = 400;

            // ZMENA: \sect\sectd\sbknone vytvor칤 kontinu치lny zlom.
            // Hne캞 za t칳m resetujeme nastavenia odseku \pard, aby prv칳 st컄pec neposko캜il.
            rtfContent += `\\sect\\sectd\\sbknone\\cols${columnsCount}\\colsxq${colGap}\\margl850\\margr850\\margt850\\margb850 `;
            rtfContent += `\\pard\\sa150 `; // Reset pre prv칰 ot치zku v sekcii
			
            groupQuestions.forEach((q, idx) => {
                const answers = shuffle([q.correct, ...q.distractors]);
                currentVariantData.questions.push({ term: q.term, answers: answers, correct: q.correct });

                // Ot치zka (keepn dr쮂 s prvou odpove캞ou)
                rtfContent += `\\pard\\keepn\\fi-360\\li360\\sa50\\b ${idx + 1}. ${toRTF(q.term)}\\b0\\par`;
                
                // Odpovede (keepn dr쮂 celok pokope)
                answers.forEach((ans, aIdx) => {
                    const keepWithNext = (aIdx < answers.length - 1) ? "\\keepn" : "";
                    rtfContent += `\\pard${keepWithNext}\\fi-360\\li720\\sa0 ${letters[aIdx]}) ${toRTF(ans)}\\par`;
                });
                rtfContent += "\\pard\\sa150 \\par "; 
            });
            
            variantHistory.push(currentVariantData);
            
            // N치vrat do 1 st컄pca
            rtfContent += "\\pard \\sect\\sectd\\sbknone\\cols1\\margl850\\margr850\\margt850\\margb850 ";
            
            // Tabu쬶a hodnotenia
            if (includeTable) {
                rtfContent += `\\par\\par\\par\\b ${toRTF("Hodnotenie")}:\\b0\\par `;
                rtfContent += "\\trowd\\trgaph108\\trleft-108";
                rtfContent += "\\clbrdrt\\brdrs\\brdrw10 \\clbrdrl\\brdrs\\brdrw10 \\clbrdrb\\brdrs\\brdrw10 \\clbrdrr\\brdrs\\brdrw10 \\cellx1000 ";
                rtfContent += "\\clbrdrt\\brdrs\\brdrw10 \\clbrdrl\\brdrs\\brdrw10 \\clbrdrb\\brdrs\\brdrw10 \\clbrdrr\\brdrs\\brdrw10 \\cellx3000 ";
                rtfContent += "\\pard\\intbl ";
                const grades = [
                    {n: toRTF("1"), min: "g1min", max: "g1max"},
                    {n: toRTF("2"), min: "g2min", max: "g2max"},
                    {n: toRTF("3"), min: "g3min", max: "g3max"},
                    {n: toRTF("4"), min: "g4min", max: "g4max"},
                    {n: toRTF("5"), min: "g5min", max: "g5max"}
                ];
                rtfContent += `\\b ${toRTF("Zn치mka")} \\cell ${toRTF("Po캜et percent")}\\cell\\row\\b0 `;
                grades.forEach(g => {
                    const min = document.getElementById(g.min).value;
                    const max = document.getElementById(g.max).value;
                    rtfContent += `${g.n} \\cell ${max} % - ${min} % \\cell\\row `;
                });
                rtfContent += "\\pard\\par ";
            }

            rtfContent += "\\par\\pard\\sl360\\slmult1 ";
            rtfContent += `${toRTF("Po캜et bodov")}: _______________\\par\\par `;
            rtfContent += `${toRTF("Po캜et percent")}: _______________\\par\\par `;
            rtfContent += `${toRTF("V칳sledn치 zn치mka a podpis u캜ite쬬")}: _____________\\par `;
            rtfContent += "\\sect\\sectd\\sbkpage\\cols1\\margl850\\margr850\\margt850\\margb850 ";
        }

        // --- 2. 캛AS콗: RIEENIA ---
        variantHistory.forEach((variant, vIdx) => {
            rtfContent += `\\pard\\qc\\b\\fs32 ${toRTF("RIEENIE")} - ${toRTF(title)} \\b0\\fs22\\par\\par`;
            rtfContent += `\\pard\\qc\\b\\fs28 ${toRTF("Skupina")} ${variant.name} \\b0\\fs22\\par\\par`;
            rtfContent += `\\pard\\sa300\\par`; // Medzera pred st컄pcami
            
            let colGap = 720;
            if(columnsCount >= 3) colGap = 400;

            rtfContent += `\\sect\\sectd\\sbknone\\cols${columnsCount}\\colsxq${colGap}\\margl850\\margr850\\margt850\\margb850 `;
            rtfContent += `\\pard\\sa150 `;

            variant.questions.forEach((q, idx) => {
                rtfContent += `\\pard\\keepn\\fi-360\\li360\\sa50\\b ${idx + 1}. ${toRTF(q.term)}\\b0\\par`;
                q.answers.forEach((ans, aIdx) => {
                    let ansText = toRTF(ans);
                    if (ans === q.correct) ansText = `\\ul ${ansText}\\ulnone`;
                    const keepWithNext = (aIdx < q.answers.length - 1) ? "\\keepn" : "";
                    rtfContent += `\\pard${keepWithNext}\\fi-360\\li720\\sa0 ${letters[aIdx]}) ${ansText}\\par`;
                });
                rtfContent += "\\pard\\sa150 \\par "; 
            });

            rtfContent += "\\pard \\sect\\sectd\\sbknone\\cols1\\margl850\\margr850\\margt850\\margb850 ";
            if (vIdx < variantHistory.length - 1) {
                rtfContent += "\\sect\\sectd\\sbkpage\\cols1\\margl850\\margr850\\margt850\\margb850 ";
            }
        });

        rtfContent += "}";

        const blob = new Blob([rtfContent], { type: "application/rtf" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        let fname = normalizeFilename(title);
        if(!fname) fname = "pracovny_list";
        a.href = url;
        a.download = fname + ".rtf";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
    
    document.getElementById("inputData").addEventListener("keydown", function(e) {
      if (e.key === "Tab") {
        e.preventDefault();
        const start = this.selectionStart;
        const end = this.selectionEnd;
        this.value = this.value.substring(0, start) + "\t" + this.value.substring(end);
        this.selectionStart = this.selectionEnd = start + 1;
      }
    });

    window.addEventListener("load", () => {
      const saved = localStorage.getItem("inputData");
      if (saved) document.getElementById("inputData").value = saved;
    });
    document.getElementById("inputData").addEventListener("input", function() {
      localStorage.setItem("inputData", this.value);
    });
</script>
<br><br>
    <b>Spracovala pomocou UI:</b> Mgr. Erika Matyiov치 (2025)
<br><br>
</body>
</html>