<!doctype html>
<html lang="sk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Generátor cvičenia: Označenie správnej odpovede krížikom</title>
  <style>
    :root {
      --border: #d0d7de; --bg: #ffffff; --muted: #6b7280; --primary: #1f2937; --accent: #2563eb;
      --ok: #d1fae5; --missed: #ecfdf5; --bad: #fee2e2;
    }
    body { font-family: Courier bold, monospace; background:#f8fafc; margin:0; padding:24px; color:var(--primary); }
    h1,h2 { margin:0 0 12px 0; }
    .card { background:#fff; border:1px solid var(--border); border-radius:10px; padding:16px; margin-bottom:16px; }
    label { display:block; margin-top:8px; font-weight:600; }
    input, textarea { width:100%; padding:10px; border:1px solid var(--border); border-radius:8px; font-size:15px; }
    textarea { min-height:140px; font-family:monospace; white-space:pre; }
    .btnbar { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
    button { padding:10px 14px; border:1px solid var(--border); border-radius:8px; cursor:pointer; font-weight:600; background:#fff; }
    button.primary { background:var(--accent); color:#fff; border-color:var(--accent); }
    table { width:100%; border-collapse:collapse; background:#fff; margin-top:12px; }
    th,td { border:1px solid var(--border); padding:8px; text-align:center; vertical-align:middle; }
    td.clickable { cursor:pointer; user-select:none; }
    .xmark { font-weight:900; font-size:18px; }
    td.state-correct{background:var(--ok);} td.state-wrong{background:var(--bad);} td.state-missed{background:var(--missed);}
    .result{margin-top:10px;padding:10px;border:1px dashed var(--border);border-radius:8px;background:#f9fafb}
    .legend{margin-top:12px;font-size:14px}
    .legend-item{display:flex;gap:8px;align-items:center;margin-bottom:6px}
    .sym{display:inline-block;width:28px;text-align:center;font-weight:700;font-size:16px;border:1px solid var(--border);border-radius:6px;padding:4px;background:#fff}
    .hidden{display:none}
    @media print {
      body { background:#fff; }
      .card { border-color:#000; }
      table, th, td { border-color:#000; }
      td { background:#fff !important; color:#000 !important; }
      td.state-correct, td.state-wrong, td.state-missed { background:#fff !important; }
      .xmark { display:none !important; }
      td.state-correct.marked::after { content:"✓"; font-weight:700; }
      td.state-wrong.marked::after   { content:"✕"; font-weight:700; }
      td.state-missed.unmarked::after{ content:"○"; font-weight:700; }
      .btnbar { display:none !important; }
    }
  </style>
</head>
<body>

<h1>Generátor cvičenia: Označenie správnej odpovede krížikom - univerzálne</h1>

<div class="card">
  <label>Názov cvičenia</label>
  <input id="titleInput" type="text" placeholder="Zadajte názov cvičenia.">

  <label>Stĺpce (oddelené čiarkou, napr.:ja,ty,on/ona/ono,my,vy,oni/ony)</label>
  <input id="columnsInput" type="text" placeholder="stĺpec1,stĺpec2,stĺpec3">
</div>

<div class="card">
  <label>Vstupné údaje oddelené TAB; prvá položka v riadku = zadanie, ďalšie položky = správne stĺpce)</label>
  <textarea id="dataInput" placeholder="som[TAB]ja&#10;sme[TAB]my&#10;je[TAB]on/ona/ono"></textarea>
  <div class="btnbar">
    <button id="saveLocal">Uložiť do localStorage</button>
    <button id="restoreLocal">Obnoviť z localStorage</button>
    <button id="clearLocal">Vymazať z localStorage</button>
  </div>
</div>

<div class="card">
  <div class="btnbar">
    <button class="primary" id="generateBtn">Vygenerovať cvičenie</button>
    <button id="exportBtn">Exportovať do HTML</button>
  </div>
</div>

<div id="exerciseHost" class="card hidden"></div>

<script>
const STORAGE_KEY = 'generator_cross_mark_v2';
const qs = (s,r=document)=>r.querySelector(s);

function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g,ch=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch])); }
function shuffleArray(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }

/* Tab insertion in textarea */
qs('#dataInput').addEventListener('keydown', e=>{
  if(e.key === 'Tab'){ e.preventDefault();
    const ta = e.target; const start = ta.selectionStart, end = ta.selectionEnd;
    ta.value = ta.value.substring(0,start) + '\t' + ta.value.substring(end);
    ta.selectionStart = ta.selectionEnd = start + 1;
  }
});

/* Local storage actions */
qs('#saveLocal').onclick = ()=>{ localStorage.setItem(STORAGE_KEY, JSON.stringify({
  title: qs('#titleInput').value, columns: qs('#columnsInput').value, data: qs('#dataInput').value
})); alert('Uložené.'); };

qs('#restoreLocal').onclick = ()=>{ const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw){ alert('Nič uložené'); return; }
  try{ const p = JSON.parse(raw); qs('#titleInput').value = p.title || ''; qs('#columnsInput').value = p.columns || ''; qs('#dataInput').value = p.data || ''; alert('Obnovené.'); }
  catch{ alert('Chyba pri obnove.'); }
};

qs('#clearLocal').onclick = ()=>{ localStorage.removeItem(STORAGE_KEY); alert('Vymazané.'); };

/* Parse rows: TAB-separated; first cell = item, rest = set of correct column labels */
function parseInput(raw){
  return raw.split(/\r?\n/).map(l=>l.trim()).filter(Boolean).map(line=>{
    const parts = line.split('\t').map(s=>s.trim()).filter(Boolean);
    return { item: parts[0], correctSet: new Set(parts.slice(1)) };
  }).filter(r=>r.item);
}

/* Columns parsing: comma-separated; trim each entry */
function parseColumns(raw){
  return String(raw||'').split(',').map(s=>s.trim()).filter(Boolean);
}

/* Render exercise into host */
function renderExercise({title, columns, rows}, host){
  host.classList.remove('hidden'); host.innerHTML = '';
  const h2 = document.createElement('h2'); h2.textContent = title || 'Cvičenie'; host.appendChild(h2);

  host.innerHTML += `<div><label>Meno žiaka</label><input type="text" id="studentName" placeholder="Zadajte meno"></div>
  <div class="card" style="background:#f9fafb;margin-top:12px;"><b>Pokyny</b>: Kliknutím označ správne bunky. Potom klikni na "Vyhodnotiť".</div>`;

  const table = document.createElement('table'); const thead = document.createElement('thead'); const thr = document.createElement('tr');
  thr.innerHTML = '<th>Zadanie</th>' + columns.map(p=>`<th>${escapeHtml(p)}</th>`).join('');
  thead.appendChild(thr); table.appendChild(thead);
  const tbody = document.createElement('tbody'); table.appendChild(tbody);
  const studentMarks = new Map();

  rows.forEach((row, rIdx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td style="text-align:left;padding:10px 8px">${escapeHtml(row.item)}</td>`;
    columns.forEach(col => {
      const td = document.createElement('td');
      td.className = 'clickable';
      td.onclick = () => {
        const set = studentMarks.get(rIdx) || new Set();
        if (set.has(col)) { set.delete(col); td.innerHTML = ''; }
        else { set.add(col); td.innerHTML = '<span class="xmark">✕</span>'; }
        studentMarks.set(rIdx, set);
      };
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });

  host.appendChild(table);

  const controls = document.createElement('div'); controls.className = 'btnbar';
  const evalBtn = document.createElement('button'); evalBtn.className = 'primary'; evalBtn.textContent = 'Vyhodnotiť';
  const resetBtn = document.createElement('button'); resetBtn.textContent = 'Opakovať pokus';
  const printBtn = document.createElement('button'); printBtn.textContent = 'Tlačiť'; printBtn.style.display = 'none';
  controls.append(evalBtn, resetBtn, printBtn); host.appendChild(controls);

  const result = document.createElement('div'); result.className = 'result hidden'; host.appendChild(result);

  evalBtn.onclick = () => {
    let total = 0, score = 0;
    rows.forEach((row, rIdx) => {
      const student = studentMarks.get(rIdx) || new Set();
      total += row.correctSet.size;
      columns.forEach((col, cIdx) => {
        const td = tbody.rows[rIdx].cells[cIdx + 1];
        td.classList.remove('state-correct', 'state-wrong', 'state-missed', 'marked', 'unmarked');
        const good = row.correctSet.has(col), mark = student.has(col);
        if (mark && good) { td.classList.add('state-correct'); score++; }
        else if (mark && !good) { td.classList.add('state-wrong'); }
        else if (!mark && good) { td.classList.add('state-missed'); }
        td.classList.add(mark ? 'marked' : 'unmarked');
      });
    });

    const percent = total ? Math.round(score / total * 100) : 0;
    const now = new Date();
    const dd = String(now.getDate()).padStart(2, '0');
    const mm = String(now.getMonth() + 1).padStart(2, '0');
    const yyyy = now.getFullYear();
    const hh = String(now.getHours()).padStart(2, '0');
    const min = String(now.getMinutes()).padStart(2, '0');

    result.classList.remove('hidden');
    result.innerHTML = `
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px">
        <div><strong>Názov testu</strong><br>${escapeHtml(title || '')}</div>
        <div><strong>Meno žiaka</strong><br>${escapeHtml(qs('#studentName').value || '')}</div>
        <div><strong>Výsledok</strong><br>${score} / ${total} (${percent}%)</div>
      </div>
      <div style="margin-top:8px"><strong>Dátum a čas</strong>: ${dd}.${mm}.${yyyy} ${hh}:${min}</div>
      <div class="legend" style="margin-top:12px">
        <div style="margin-top:6px"><strong>Vysvetlivky symbolov</strong></div>
        <div class="legend-item"><span class="sym">✓</span><div>Správne označené — žiak označil bunku a bunka bola správna.</div></div>
        <div class="legend-item"><span class="sym">✕</span><div>Nesprávne označené — žiak označil bunku, ktorá nebola správna.</div></div>
        <div class="legend-item"><span class="sym">○</span><div>Správna, ale neoznačená — bunka bola správna, ale žiak ju neoznačil.</div></div>
      </div>
    `;
    printBtn.style.display = '';
  };

  resetBtn.onclick = () => {
    const shuffled = shuffleArray([...rows]);
    renderExercise({ title, columns, rows: shuffled }, host);
  };

  printBtn.onclick = () => window.print();
}

/* Export - vytvorí samostatný HTML súbor s aktuálnymi nastaveniami */
function generateExportHTML(title, columnsCSV, dataRaw) {
  const esc = s => String(s || '').replace(/`/g, '\\`').replace(/<\/script>/gi, '<\\/script>');
  const exported = `<!doctype html>
<html lang="sk">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>${esc(title) || 'Cvičenie'}</title>
<style>
  :root {
    --border: #d0d7de; --bg: #ffffff; --muted: #6b7280; --primary: #1f2937; --accent: #2563eb;
    --ok: #d1fae5; --missed: #ecfdf5; --bad: #fee2e2;
  }
  body { font-family: Courier bold, monospace; background:#f8fafc; margin:0; padding:24px; color:var(--primary); }
  h1,h2 { margin:0 0 12px 0; }
  .card { background:#fff; border:1px solid var(--border); border-radius:10px; padding:16px; margin-bottom:16px; }
  label { display:block; margin-top:8px; font-weight:600; }
  input { width:100%; padding:10px; border:1px solid var(--border); border-radius:8px; font-size:15px; }
  .btnbar { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
  button { padding:10px 14px; border:1px solid var(--border); border-radius:8px; cursor:pointer; font-weight:600; background:#fff; }
  button.primary { background:var(--accent); color:#fff; border-color:var(--accent); }
  table { width:100%; border-collapse:collapse; background:#fff; margin-top:12px; }
  th,td { border:1px solid var(--border); padding:8px; text-align:center; vertical-align:middle; }
  td.clickable { cursor:pointer; user-select:none; }
  .xmark { font-weight:900; font-size:18px; }
  td.state-correct{background:var(--ok);} td.state-wrong{background:var(--bad);} td.state-missed{background:var(--missed);}
  .result{margin-top:10px;padding:10px;border:1px dashed var(--border);border-radius:8px;background:#f9fafb}
  .legend{margin-top:12px;font-size:14px}
  .legend-item{display:flex;gap:8px;align-items:center;margin-bottom:6px}
  .sym{display:inline-block;width:28px;text-align:center;font-weight:700;font-size:16px;border:1px solid var(--border);border-radius:6px;padding:4px;background:#fff}
  .hidden{display:none}
  @media print {
    body { background:#fff; }
    .card { border-color:#000; }
    table, th, td { border-color:#000; }
    td { background:#fff !important; color:#000 !important; }
    td.state-correct, td.state-wrong, td.state-missed { background:#fff !important; }
    .xmark { display:none !important; }
    td.state-correct.marked::after { content:"✓"; font-weight:700; }
    td.state-wrong.marked::after   { content:"✕"; font-weight:700; }
    td.state-missed.unmarked::after{ content:"○"; font-weight:700; }
    .btnbar { display:none !important; }
  }
</style>
</head>
<body>
<div id="exerciseHost" class="card"></div>
<script>
const columns = ${JSON.stringify(columnsCSV.split(',').map(s=>s.trim()).filter(Boolean))};
const rawData = ${JSON.stringify(dataRaw)};

function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g,ch=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch])); }
function parseInput(raw){
  return raw.split(/\\r?\\n/).map(l=>l.trim()).filter(Boolean).map(line=>{
    const parts = line.split('\\t').map(s=>s.trim()).filter(Boolean);
    return { item: parts[0], correctSet: new Set(parts.slice(1)) };
  }).filter(r=>r.item);
}
function shuffleArray(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }

function renderExercise({title, columns, rows}, host){
  host.innerHTML = '';
  const h1 = document.createElement('h1'); h1.textContent = title || 'Cvičenie'; host.appendChild(h1);
  host.innerHTML += '<div><label>Meno žiaka</label><input type="text" id="studentName" placeholder="Zadajte meno."></div>' +
    '<div class="card" style="background:#f9fafb;margin-top:12px;"><b>Pokyny</b>: Kliknutím označ správne bunky. Potom klikni na "Vyhodnotiť".</div>';
  const table = document.createElement('table'); const thead = document.createElement('thead'); const thr = document.createElement('tr');
  thr.innerHTML = '<th>Zadanie</th>' + columns.map(p=>'<th>'+escapeHtml(p)+'</th>').join('');
  thead.appendChild(thr); table.appendChild(thead);
  const tbody = document.createElement('tbody'); table.appendChild(tbody);
  const studentMarks = new Map();
  rows.forEach((row, rIdx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = '<td style="text-align:left;padding:10px 8px">'+escapeHtml(row.item)+'</td>';
    columns.forEach(col => {
      const td = document.createElement('td');
      td.className = 'clickable';
      td.onclick = () => {
        const set = studentMarks.get(rIdx) || new Set();
        if (set.has(col)) { set.delete(col); td.innerHTML = ''; }
        else { set.add(col); td.innerHTML = '<span class="xmark">✕</span>'; }
        studentMarks.set(rIdx, set);
      };
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
  host.appendChild(table);
  const controls = document.createElement('div'); controls.className = 'btnbar';
  const evalBtn = document.createElement('button'); evalBtn.className = 'primary'; evalBtn.textContent = 'Vyhodnotiť';
  const resetBtn = document.createElement('button'); resetBtn.textContent = 'Opakovať pokus';
  const printBtn = document.createElement('button'); printBtn.textContent = 'Tlačiť'; printBtn.style.display = 'none';
  controls.append(evalBtn, resetBtn, printBtn); host.appendChild(controls);
  const result = document.createElement('div'); result.className = 'result hidden'; host.appendChild(result);
  evalBtn.onclick = () => {
    let total = 0, score = 0;
    rows.forEach((row, rIdx) => {
      const student = studentMarks.get(rIdx) || new Set();
      total += row.correctSet.size;
      columns.forEach((col, cIdx) => {
        const td = tbody.rows[rIdx].cells[cIdx + 1];
        td.classList.remove('state-correct', 'state-wrong', 'state-missed', 'marked', 'unmarked');
        const good = row.correctSet.has(col), mark = student.has(col);
        if (mark && good) { td.classList.add('state-correct'); score++; }
        else if (mark && !good) { td.classList.add('state-wrong'); }
        else if (!mark && good) { td.classList.add('state-missed'); }
        td.classList.add(mark ? 'marked' : 'unmarked');
      });
    });
    const percent = total ? Math.round(score / total * 100) : 0;
    const now = new Date();
    const dd = String(now.getDate()).padStart(2, '0');
    const mm = String(now.getMonth() + 1).padStart(2, '0');
    const yyyy = now.getFullYear();
    const hh = String(now.getHours()).padStart(2, '0');
    const min = String(now.getMinutes()).padStart(2, '0');
    result.classList.remove('hidden');
    result.innerHTML = '<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px">' +
      '<div><strong>Názov testu</strong><br>'+escapeHtml(title||'')+'</div>' +
      '<div><strong>Meno žiaka</strong><br>'+escapeHtml(document.getElementById('studentName').value||'')+'</div>' +
      '<div><strong>Výsledok</strong><br>'+score+' / '+total+' ('+percent+'%)</div>' +
      '</div><div style="margin-top:8px"><strong>Dátum a čas</strong>: '+dd+'.'+mm+'.'+yyyy+' '+hh+':'+min+'</div>' +
      '<div class="legend" style="margin-top:12px">' +
      '<div style="margin-top:6px"><strong>Vysvetlivky symbolov</strong></div>' +
      '<div class="legend-item"><span class="sym">✓</span><div>Správne označené — žiak označil bunku a bunka bola správna.</div></div>' +
      '<div class="legend-item"><span class="sym">✕</span><div>Nesprávne označené — žiak označil bunku, ktorá nebola správna.</div></div>' +
      '<div class="legend-item"><span class="sym">○</span><div>Správna, ale neoznačená — bunka bola správna, ale žiak ju neoznačil.</div></div>' +
      '</div>';
    printBtn.style.display = '';
  };

  // Opakovať pokus: nové náhodné poradie
  resetBtn.onclick = () => start();

  printBtn.onclick = () => window.print();
}

// Základné riadky z raw vstupu; start() zaručí miešanie pri načítaní
let baseRows = parseInput(rawData);
function start() {
  const shuffled = shuffleArray([...baseRows]);
  renderExercise({title: ${JSON.stringify(esc(title))}, columns, rows: shuffled}, document.getElementById('exerciseHost'));
}
start();
<\/script>
<br><br>
  <b>Spracovala pomocou UI:</b> Mgr. Erika Matyiová (2025)
<br><br>
</body>
</html>`;
  return exported;
}

/* Export button behavior creates downloadable file */
qs('#exportBtn').onclick = () => {
  const title = qs('#titleInput').value || '';
  const columnsCSV = qs('#columnsInput').value || '';
  const dataRaw = qs('#dataInput').value || '';
  const exportedHTML = generateExportHTML(title, columnsCSV, dataRaw);
  const blob = new Blob([exportedHTML], {type: 'text/html;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  const name = (title && title.trim()) ? title.replace(/[\\\/:*?"<>|]/g,'_') + '.html' : 'exercise.html';
  a.download = name;
  document.body.appendChild(a);
  a.click();
  a.remove();
  setTimeout(()=>URL.revokeObjectURL(url), 10000);
};

qs('#generateBtn').onclick = () => {
  const title = qs('#titleInput').value.trim();
  const columns = parseColumns(qs('#columnsInput').value);
  const rows = parseInput(qs('#dataInput').value);
  if (columns.length === 0) { alert('Zadajte aspoň jeden stĺpec.'); return; }
  if (rows.length === 0) { alert('Nie sú žiadne platné riadky. Skontrolujte vstup a TAB oddelenie.'); return; }
  const shuffled = shuffleArray([...rows]);
  renderExercise({ title, columns, rows: shuffled }, qs('#exerciseHost'));
  window.scrollTo({ top: qs('#exerciseHost').offsetTop - 20, behavior: 'smooth' });
};
</script>
<br><br>
  <b>Spracovala pomocou UI:</b> Mgr. Erika Matyiová (2025)
<br><br>
</body>
</html>