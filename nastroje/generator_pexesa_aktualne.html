<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <title>Generátor PEXESA</title>
    <style>
        body { font-family: sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; background: #f4f4f4; }
        h1 { text-align: center; color: #333; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #ccc; }
        .tab { padding: 10px 20px; cursor: pointer; background: #ddd; border-radius: 5px 5px 0 0; font-weight: bold; }
        .tab.active { background: #fff; border: 2px solid #ccc; border-bottom: 2px solid #fff; margin-bottom: -2px; }
        .content { display: none; background: #fff; padding: 20px; border: 2px solid #ccc; border-radius: 0 0 5px 5px; }
        .content.active { display: block; }
        
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], textarea { width: 100%; padding: 8px; box-sizing: border-box; }
        textarea { height: 180px; font-family: monospace; font-size: 120%; line-height: 1.4; white-space: pre; overflow-x: auto; }
        .btn { background: #28a745; color: white; border: none; padding: 10px 20px; font-size: 16px; cursor: pointer; border-radius: 5px; display: block; width: 100%; margin-top: 20px; }
        .btn:hover { background: #218838; }
        .color-picker { display: flex; align-items: center; gap: 10px; }
        .info { font-size: 0.85em; color: #555; background: #fff3cd; padding: 8px; border-radius: 4px; margin-bottom: 10px; border-left: 4px solid #ffc107; }
    </style>
</head>
<body>

<h1>Generátor interaktívneho pexesa</h1>

<div class="form-group">
    <label>Názov stránky (nadpis hry):</label>
    <input type="text" id="gameTitle" placeholder="Napr. Pexeso: Ovocie">
</div>

<div class="form-group">
    <label>Autor pexesa:</label>
    <input type="text" id="gameAuthor" placeholder="Meno autora (zobrazí sa pod nadpisom)">
</div>

<div class="form-group">
    <label>Text po ukončení hry (gratulácia):</label>
    <input type="text" id="winText" value="Super!">
</div>

<div class="form-group">
    <label>Farba rubu kartičiek:</label>
    <div class="color-picker">
        <input type="color" id="cardColor" value="#3498db">
        <span>Vyberte farbu pozadia kartičiek</span>
    </div>
</div>

<div class="tabs">
    <div class="tab active" onclick="switchTab(event, 'v1')">1. obrázok : obrázok</div>
    <div class="tab" onclick="switchTab(event, 'v2')">2. obrázok : text</div>
    <div class="tab" onclick="switchTab(event, 'v3')">3. text : text</div>
</div>

<div id="v1" class="content active">
    <h3>Verzia 1: obrázok - obrázok</h3>
    <div class="form-group">
        <label>Nahrať 10 obrázkov (pár tvoria dva rovnaké obrázky):</label>
        <input type="file" id="v1files" multiple accept="image/*">
    </div>
    <button class="btn" onclick="generateGame('v1')">Stiahnuť PEXESO</button>
	<br><br>
  <b>Spracovala pomocou UI:</b> Mgr. Erika Matyiová (2026)
  <br><br>
</div>

<div id="v2" class="content">
    <h3>Verzia 2: obrázok - text</h3>
    <div class="info">Klávesa <b>TAB</b> funguje priamo v poli nižšie. Názov súboru bez prípony (napr. 01) musí byť pred tabulátorom.</div>
    <div class="form-group">
        <label>Nahrať 10 obrázkov:</label>
        <input type="file" id="v2files" multiple accept="image/*">
    </div>
    <div class="form-group">
        <label>Definície (Názov súboru[TAB]Text na párovej karte):</label>
        <textarea id="v2text" placeholder="01[TAB]jablko&#10;02[TAB]hruška"></textarea>
    </div>
    <button class="btn" onclick="generateGame('v2')">Stiahnuť PEXESO</button>
	<br><br>
  <b>Spracovala pomocou UI:</b> Mgr. Erika Matyiová (2025)
  <br><br>
</div>

<div id="v3" class="content">
    <h3>Verzia 3: Text - Text</h3>
    <div class="info">Zadajte dvojice textov oddelené klávesou <b>TAB</b>. Každý pár treba zadať na nový riadok.</div>
    <div class="info" style="background: #e3f2fd; border-left-color: #2196f3;"><b>Nové:</b> Ľavý stĺpec bude mať v hre svetlosivé pozadie, pravý stĺpec biele pozadie.</div>
    <div class="form-group">
        <label>Pojmy a definície (Pojem[TAB]Definícia):</label>
        <textarea id="v3text" placeholder="der Apfel[TAB]jablko&#10;die Birne[TAB]hruška"></textarea>
    </div>
    <button class="btn" onclick="generateGame('v3')">Stiahnuť PEXESO</button>
	<br><br>
  <b>Spracovala pomocou UI:</b> Mgr. Erika Matyiová (2025)
  <br><br>
</div>

<script>
    // LocalStorage management
    const inputs = ['gameTitle', 'gameAuthor', 'winText', 'v2text', 'v3text'];
    inputs.forEach(id => {
        const el = document.getElementById(id);
        if(localStorage.getItem(id)) el.value = localStorage.getItem(id);
        el.addEventListener('input', () => localStorage.setItem(id, el.value));
    });

    // Podpora TAB v textarei
    document.querySelectorAll('textarea').forEach(textarea => {
        textarea.addEventListener('keydown', function(e) {
            if (e.key === 'Tab') {
                e.preventDefault();
                const start = this.selectionStart;
                const end = this.selectionEnd;
                this.value = this.value.substring(0, start) + "\t" + this.value.substring(end);
                this.selectionStart = this.selectionEnd = start + 1;
            }
        });
    });

    function switchTab(e, tabId) {
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        e.currentTarget.classList.add('active');
    }

    function readFiles(fileList) {
        const promises = [];
        Array.from(fileList).forEach(file => {
            promises.push(new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve({ name: file.name, data: e.target.result });
                reader.onerror = reject;
                reader.readAsDataURL(file);
            }));
        });
        return Promise.all(promises);
    }

    async function generateGame(version) {
        const title = document.getElementById('gameTitle').value || 'PEXESO';
        const author = document.getElementById('gameAuthor').value || '';
        const winMsg = document.getElementById('winText').value || 'Super!';
        const color = document.getElementById('cardColor').value;
        let pairs = [];

        try {
            if (version === 'v1') {
                const files = document.getElementById('v1files').files;
                if (files.length === 0) throw new Error("Nahrajte aspoň jeden obrázok.");
                const images = await readFiles(files);
                images.forEach(img => pairs.push({ type1: 'img', content1: img.data, type2: 'img', content2: img.data }));
            } 
            else if (version === 'v2') {
                const files = document.getElementById('v2files').files;
                const textRaw = document.getElementById('v2text').value;
                if (files.length === 0) throw new Error("Nahrajte obrázky.");
                const images = await readFiles(files);
                const textMap = {};
                textRaw.trim().split('\n').forEach(line => {
                    const parts = line.split('\t');
                    if(parts.length >= 2) textMap[parts[0].trim()] = parts[1].trim();
                });
                images.forEach(img => {
                    const nameKey = img.name.split('.')[0];
                    const matchKey = Object.keys(textMap).find(k => nameKey.includes(k));
                    if(matchKey) pairs.push({ type1: 'img', content1: img.data, type2: 'text', content2: textMap[matchKey] });
                });
            } 
            else if (version === 'v3') {
                const textRaw = document.getElementById('v3text').value;
                const lines = textRaw.trim().split('\n');
                lines.forEach(line => {
                    if (line.includes('\t')) {
                        const parts = line.split('\t');
                        if (parts.length >= 2) {
                            pairs.push({ 
                                type1: 'text', content1: parts[0].trim(), bg1: '#ebebeb', // Svetlosivá pre ľavý stĺpec
                                type2: 'text', content2: parts[1].trim(), bg2: '#ffffff'  // Biela pre pravý stĺpec
                            });
                        }
                    }
                });
            }

            if(pairs.length === 0) throw new Error("Neboli vytvorené žiadne páry.");

            const finalHTML = createGameHTML(title, author, winMsg, color, pairs);
            downloadHTML(finalHTML, `pexeso_v3_upravene.html`);
        } catch (e) { alert("Chyba: " + e.message); }
    }

    function downloadHTML(content, filename) {
        const blob = new Blob([content], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        setTimeout(() => document.body.removeChild(a), 100);
    }

    function createGameHTML(title, author, winMsg, backColor, pairsData) {
        const serializedData = JSON.stringify(pairsData);

        return `<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>${title}</title>
<style>
    :root { --card-back: ${backColor}; --gap: 10px; }
    body { font-family: sans-serif; margin: 0; padding: 20px; background: #fffbe6; display: flex; flex-direction: column; align-items: center; }
    h1 { margin-bottom: 5px; text-align: center; }
    .author { font-style: italic; color: #666; margin-bottom: 20px; font-size: 1.1em; }
    .game-board { display: grid; grid-template-columns: repeat(5, 1fr); gap: var(--gap); width: 100%; max-width: 900px; }
    .card-slot { position: relative; aspect-ratio: 4/3; background: #f0f0f0; border-radius: 8px; }
    .slot-number { position: absolute; width: 100%; height: 100%; display: none; justify-content: center; align-items: center; font-size: 2em; color: #ddd; font-weight: bold; }
    .show-numbers .slot-number { display: flex; }
    .card { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 0.6s; cursor: pointer; z-index: 2; }
    .card.flipped { transform: rotateY(180deg); }
    .card.matched { display: none !important; }
    .face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 8px; display: flex; justify-content: center; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .front { background-color: var(--card-back); transform: rotateY(0deg); }
    .card-num-overlay { font-size: 2.5em; color: rgba(255,255,255,0.4); font-weight: bold; display: none; }
    .show-numbers .card-num-overlay { display: block; }
    .back { background-color: white; transform: rotateY(180deg); border: 2px solid var(--card-back); padding: 5px; box-sizing: border-box; }
    .card-image { max-width: 100%; max-height: 100%; object-fit: contain; }
    .card-text { text-align: center; font-weight: bold; color: #333; width: 100%; padding: 5px; box-sizing: border-box; word-wrap: break-word; }
    .controls { margin-bottom: 20px; display: flex; gap: 20px; font-weight: bold; font-size: 1.2em; }
    .settings { margin-top: 30px; display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; color: #555; font-size: 0.9em; }
    .hidden { display: none !important; }
    #successOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; }
    #successText { font-size: 10vw; color: green; font-weight: bold; margin: 0; text-align: center; z-index: 2; padding: 20px; }
    canvas#fireworks { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
    .restart-btn { margin-top: 20px; padding: 15px 30px; font-size: 1.5em; cursor: pointer; background: green; color: white; border: none; border-radius: 10px; z-index: 3; }
</style>
</head>
<body>
<h1>${title}</h1>
${author ? `<div class="author">Autor: ${author}</div>` : ''}

<div class="controls">
    <div id="timerBox">Čas: <span id="time">00:00</span></div>
    <div id="movesBox">Ťahy: <span id="moves">0</span></div>
</div>
<div class="game-board" id="board"></div>
<div class="settings">
    <label><input type="checkbox" id="toggleTimer" checked> Čas</label>
    <label><input type="checkbox" id="toggleMoves" checked> Ťahy</label>
    <label><input type="checkbox" id="toggleNumbers"> Čísla</label>
    <button onclick="location.reload()">Reštartovať</button>
</div>
<div id="successOverlay">
    <canvas id="fireworks"></canvas>
    <h2 id="successText">${winMsg}</h2>
    <button class="restart-btn" onclick="location.reload()">Hrať znova</button>
</div>
<script>
    const pairsData = ${serializedData};
    let firstCard, secondCard, lockBoard = false, moves = 0, seconds = 0, gameStarted = false, timerInterval;

    function init() {
        const board = document.getElementById('board');
        let deck = [];
        pairsData.forEach((p, i) => {
            // Pridane citanie farby pozadia (p.bg1/bg2), default je biela
            deck.push({ id: i, type: p.type1, content: p.content1, bg: p.bg1 || 'white' });
            deck.push({ id: i, type: p.type2, content: p.content2, bg: p.bg2 || 'white' });
        });
        deck.sort(() => 0.5 - Math.random());
        deck.forEach((item, i) => {
            const slot = document.createElement('div');
            slot.classList.add('card-slot');
            const sn = document.createElement('div'); sn.className = 'slot-number'; sn.innerText = i + 1; slot.appendChild(sn);
            const card = document.createElement('div'); card.className = 'card'; card.dataset.id = item.id;
            const f = document.createElement('div'); f.className = 'face front';
            const ov = document.createElement('span'); ov.className = 'card-num-overlay'; ov.innerText = i + 1; f.appendChild(ov);
            
            // Aplikacia farby pozadia
            const b = document.createElement('div'); b.className = 'face back';
            b.style.backgroundColor = item.bg;

            if(item.type === 'img') {
                const img = document.createElement('img'); img.src = item.content; img.className = 'card-image'; b.appendChild(img);
            } else {
                const txt = document.createElement('div'); txt.className = 'card-text'; txt.innerText = item.content; b.appendChild(txt);
            }
            card.appendChild(f); card.appendChild(b);
            card.addEventListener('click', flipCard);
            slot.appendChild(card); board.appendChild(slot);
        });
        setTimeout(fitAllTexts, 100);
    }

    function flipCard() {
        if (lockBoard || this === firstCard) return;
        if (!gameStarted) {
            gameStarted = true;
            timerInterval = setInterval(() => {
                seconds++;
                const m = Math.floor(seconds/60).toString().padStart(2,'0');
                const s = (seconds%60).toString().padStart(2,'0');
                document.getElementById('time').innerText = \`\${m}:\${s}\`;
            }, 1000);
        }
        this.classList.add('flipped');
        if (!firstCard) { firstCard = this; return; }
        secondCard = this;
        moves++; document.getElementById('moves').innerText = moves;
        if (firstCard.dataset.id === secondCard.dataset.id) {
            lockBoard = true;
            setTimeout(() => { firstCard.classList.add('matched'); secondCard.classList.add('matched'); checkWin(); reset(); }, 800);
        } else {
            lockBoard = true;
            setTimeout(() => { firstCard.classList.remove('flipped'); secondCard.classList.remove('flipped'); reset(); }, 1200);
        }
    }

    function reset() { [firstCard, secondCard, lockBoard] = [null, null, false]; }

    function checkWin() {
        if (document.querySelectorAll('.card:not(.matched)').length === 0) {
            clearInterval(timerInterval);
            setTimeout(() => {
                document.getElementById('successOverlay').style.display = 'flex';
                startFireworks();
            }, 500);
        }
    }

    function fitAllTexts() {
        document.querySelectorAll('.card-text').forEach(el => {
            let fs = 24; el.style.fontSize = fs + 'px';
            const p = el.parentElement;
            while ((el.scrollWidth > p.clientWidth - 10 || el.scrollHeight > p.clientHeight - 10) && fs > 7) { 
                fs--; el.style.fontSize = fs + 'px'; 
            }
        });
    }

    function startFireworks() {
        const canvas = document.getElementById('fireworks');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let particles = [];
        class Particle {
            constructor(x, y, color) {
                this.x = x; this.y = y; this.color = color;
                this.velocity = { x: (Math.random()-0.5)*10, y: (Math.random()-0.5)*10 };
                this.alpha = 1; this.friction = 0.95;
            }
            draw() {
                ctx.globalAlpha = this.alpha; ctx.beginPath(); ctx.arc(this.x, this.y, 3, 0, Math.PI*2);
                ctx.fillStyle = this.color; ctx.fill();
            }
            update() {
                this.velocity.x *= this.friction; this.velocity.y *= this.friction;
                this.x += this.velocity.x; this.y += this.velocity.y; this.alpha -= 0.012;
            }
        }
        function animate() {
            if (document.getElementById('successOverlay').style.display !== 'flex') return;
            requestAnimationFrame(animate);
            ctx.fillStyle = 'rgba(255, 255, 255, 0.15)'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            if (Math.random() < 0.08) {
                const x = Math.random() * canvas.width; const y = Math.random() * canvas.height * 0.7;
                const color = \`hsl(\${Math.random()*360}, 70%, 50%)\`;
                for(let i=0; i<40; i++) particles.push(new Particle(x, y, color));
            }
            particles.forEach((p, i) => { if(p.alpha <= 0) particles.splice(i, 1); else { p.update(); p.draw(); } });
        }
        animate();
    }

    document.getElementById('toggleTimer').addEventListener('change', e => document.getElementById('timerBox').classList.toggle('hidden', !e.target.checked));
    document.getElementById('toggleMoves').addEventListener('change', e => document.getElementById('movesBox').classList.toggle('hidden', !e.target.checked));
    document.getElementById('toggleNumbers').addEventListener('change', e => document.getElementById('board').classList.toggle('show-numbers', e.target.checked));

    init();
<\/script>
</body>
</html>`;
    }
</script>
</body>
</html>