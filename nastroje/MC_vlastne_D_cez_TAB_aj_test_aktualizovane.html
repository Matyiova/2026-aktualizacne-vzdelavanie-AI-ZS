<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <title>Gener√°tor testu s v√Ωberom odpovede s vlastn√Ωmi distraktormi (TAB)</title>
  <style>
    body { font-family: Courier bold, monospace; font-size: 120%; padding: 20px; }
    .question { margin-bottom: 20px; }
    .question h3 { margin-bottom: 10px; }
    .answers label { display: block; margin-bottom: 5px; padding: 5px; border-radius: 4px; }
    .correct { background-color: #c8f7c5; }
    .incorrect { background-color: #f7c5d1; }
    .missing { background-color: #ffe6b3; }
    .feedback { font-weight: bold; margin-top: 5px; }
    #results { margin-top: 30px; font-size: 1.1em; }
  </style>
</head>
<body>
<h1>Gener√°tor testu - v√Ωber odpovede (vlastn√© distraktory cez [TAB])</h1>
  <h2>Vstupn√© √∫daje</h2>
  <span style="font-size: 122%;"><span style="font-weight: bold; color: blue;">pojem</span>[TAB]<span style="font-weight: bold; color: darkgreen;">defin√≠cia</span>[TAB]<span style="font-weight: bold; color: darkred;">distraktor 1</span>[TAB]<span style="font-weight: bold; color: darkred;">distraktor 2</span>[TAB]<span style="font-weight: bold; color: darkred;">distraktor 3</span> (nepovinn√Ω)</span>
  <div style="height: 10px;"></div>
  <textarea id="inputData" rows="10" cols="160" placeholder="pojem[TAB]defin√≠cia[TAB]distraktor 1[TAB]distraktor 2[TAB]distraktor 3" style="font-size: 122%;"></textarea>
  <br><br>
  <b>Meno ≈æiaka, trieda:</b> <input type="text" id="studentName" style="width:350px;">
  <br><br>
  <b>Poƒçet ot√°zok:</b> <input type="number" id="questionCount" min="1">
  <br><br>
  
  <br><br>
<b>N√°zov s√∫boru:</b> <input type="text" id="fileName" placeholder="napr. test_z_biologie.html" style="width:400px;">
<br><br>
<b>Nadpis testu:</b> <input type="text" id="testTitle" placeholder="napr. Test z biol√≥gie ‚Äì 2. roƒçn√≠k" style="width:400px;">
<br><br>
<button onclick="saveTestAsHTML()">Ulo≈æi≈• test ako HTML</button>

  <button onclick="generateTest()">Vygenerova≈• test</button>
  
  <div id="testArea"></div>
  <div id="results"></div>
  
  <button onclick="resetTest()">Znova</button>
  <button onclick="submitTest()">Odosla≈• odpovede</button>
  <script>
    let currentQuestions = [];

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function generateTest() {
      const input = document.getElementById("inputData").value.trim();
      const lines = input.split("\n");
      const allQuestions = [];

      for (let line of lines) {
        const parts = line.split("\t");
        if (parts.length < 3) continue;

        const term = parts[0];
        const correct = parts[1];
        const distractors = parts.slice(2);
        const allAnswers = shuffle([correct, ...distractors]);

        allQuestions.push({ term, correct, answers: allAnswers });
      }

      const count = parseInt(document.getElementById("questionCount").value) || allQuestions.length;
      currentQuestions = shuffle(allQuestions).slice(0, count);

      const testDiv = document.getElementById("testArea");
      testDiv.innerHTML = "";

      currentQuestions.forEach((q, index) => {
        const questionDiv = document.createElement("div");
        questionDiv.className = "question";

        const title = document.createElement("h3");
        title.textContent = `${index + 1}. ${q.term}`;
        questionDiv.appendChild(title);

        const answersDiv = document.createElement("div");
        answersDiv.className = "answers";

        q.answers.forEach((ans, i) => {
          const label = document.createElement("label");
          label.setAttribute("data-answer", ans);
          const radio = document.createElement("input");
          radio.type = "radio";
          radio.name = `question${index}`;
          radio.value = ans;
          label.appendChild(radio);
          label.appendChild(document.createTextNode(" " + ans));
          answersDiv.appendChild(label);
        });

        questionDiv.appendChild(answersDiv);
        testDiv.appendChild(questionDiv);
      });

      document.getElementById("results").innerHTML = "";
    }

function normalizeFilename(text) {
  return text
    .normalize("NFD") // rozdel√≠ znaky na z√°klad + diakritiku
    .replace(/[\u0300-\u036f]/g, "") // odstr√°ni diakritiku
    .replace(/[^a-zA-Z0-9-_ ]/g, "") // odstr√°ni ≈°peci√°lne znaky
    .replace(/\s+/g, "_"); // nahrad√≠ medzery podƒçiarkovn√≠kom
}


    function submitTest() {
      let score = 0;
      const testDiv = document.getElementById("testArea");
      const name = document.getElementById("studentName").value || "Nezadan√© meno";
      const now = new Date();
      const dateStr = now.toLocaleString();

      currentQuestions.forEach((q, index) => {
        const radios = document.getElementsByName(`question${index}`);
        let selected = null;
        radios.forEach(r => { if (r.checked) selected = r.value; });

        const labels = radios[0].closest(".answers").querySelectorAll("label");
        labels.forEach(label => {
          const val = label.getAttribute("data-answer");
          if (val === q.correct) {
            label.classList.add("correct");
          }
          if (selected === val && val !== q.correct) {
            label.classList.add("incorrect");
          }
        });

        const feedback = document.createElement("div");
        feedback.className = "feedback";

        if (selected === q.correct) {
          score++;
          feedback.textContent = "‚úÖ Spr√°vna odpoveƒè";
        } else if (selected === null) {
          feedback.textContent = "‚ö†Ô∏è Ch√Ωbaj√∫ca odpoveƒè";
          labels.forEach(label => {
            if (label.getAttribute("data-answer") === q.correct) {
              label.classList.add("missing");
            }
          });
        } else {
          feedback.textContent = "‚ùå Nespr√°vna odpoveƒè";
        }

        radios[0].closest(".question").appendChild(feedback);
      });

      const percent = ((score / currentQuestions.length) * 100).toFixed(2);
      document.getElementById("results").innerHTML = `
        <hr>
        <h3>V√Ωsledky testu</h3>
        <p><strong>Meno ≈æiaka:</strong> ${name}</p>
        <p><strong>Poƒçet z√≠skan√Ωch bodov:</strong> ${score} / ${currentQuestions.length}</p>
        <p><strong>Poƒçet percent:</strong> ${percent} %</p>
        <p><strong>D√°tum a ƒças konania testu:</strong> ${dateStr}</p>
      `;
    }

    function resetTest() {
      document.getElementById("testArea").innerHTML = "";
      document.getElementById("results").innerHTML = "";
      generateTest();
    }
	
function saveTestAsHTML() {
  const testTitle = document.getElementById("testTitle").value.trim() || "Test";
  const questionCount = parseInt(document.getElementById("questionCount").value) || 10;
  const inputData = document.getElementById("inputData").value.trim();
  const safeFileName = normalizeFilename(testTitle) + ".html";

  // Parsovanie ot√°zok
  const allQuestions = inputData
    .split("\n")
    .map(line => {
      const parts = line.split("\t");
      if (parts.length < 3) return null;
      return { term: parts[0], correct: parts[1], answers: parts.slice(2) };
    })
    .filter(q => q !== null);

  // Stavba HTML re≈•azca
  let htmlContent = "";
  htmlContent += "<!DOCTYPE html>\n";
  htmlContent += "<html lang=\"sk\">\n";
  htmlContent += "<head>\n";
  htmlContent += "  <meta charset=\"UTF-8\">\n";
  htmlContent += "  <title>" + testTitle + "</title>\n";
  htmlContent += "  <style>\n";
  htmlContent += "    :root { --bg-light:#fff; --text-light:#000; --bg-dark:#001f3f; --text-dark:#fff; }\n";
  htmlContent += "    body { font-family:Courier bold,monospace; font-size:120%; padding:20px; margin:0; background:var(--bg-light); color:var(--text-light); transition:0.3s; }\n";
  htmlContent += "    body.dark-mode { background:var(--bg-dark); color:var(--text-dark); }\n";
  htmlContent += "    #themeToggle { position:fixed; top:15px; right:15px; z-index:100; padding:6px 12px; border:none; border-radius:4px; background:#ddd; cursor:pointer; transition:0.3s; }\n";
  htmlContent += "    #themeToggle.dark { background:#444; color:#fff; }\n";
  htmlContent += "    .question-block { border:1px solid #ccc; padding:10px; margin:10px 0; border-radius:4px; }\n";
  htmlContent += "    .question-title { font-weight:bold; margin-bottom:5px; }\n";
  htmlContent += "    .answers label { display:block; margin:4px 0; padding:4px; border-radius:3px; }\n";
  htmlContent += "    .missing { background:#ffe6b3; }\n";
  htmlContent += "    .correct { background:#c8f7c5; }\n";
  htmlContent += "    .incorrect { background:#f7c5d1; }\n";
  htmlContent += "    body.dark-mode .missing, body.dark-mode .correct, body.dark-mode .incorrect { color:#000; }\n";
  htmlContent += "  </style>\n";
  htmlContent += "</head>\n";
  htmlContent += "<body>\n";

  // Prep√≠naƒç t√©m
  htmlContent += "  <button id=\"themeToggle\">üåô Tmav√Ω re≈æim</button>\n";
  htmlContent += "  <h2>" + testTitle + "</h2>\n";
  htmlContent += "  <form id=\"quizForm\"></form>\n";

  // Skript na mot√≠vy a test - opraven√© pre spr√°vne mapovanie zobrazen√Ωch ot√°zok (qs) pri vyhodnocovan√≠
  htmlContent += "  <script>\n";
  htmlContent += "    document.addEventListener('DOMContentLoaded', function() {\n";
  htmlContent += "      var btn = document.getElementById('themeToggle');\n";
  htmlContent += "      if (localStorage.getItem('theme') === 'dark') {\n";
  htmlContent += "        document.body.classList.add('dark-mode');\n";
  htmlContent += "        btn.classList.add('dark');\n";
  htmlContent += "        btn.textContent = '‚òÄÔ∏è Svetl√Ω re≈æim';\n";
  htmlContent += "      }\n";
  htmlContent += "      btn.addEventListener('click', function() {\n";
  htmlContent += "        var dark = document.body.classList.toggle('dark-mode');\n";
  htmlContent += "        btn.classList.toggle('dark');\n";
  htmlContent += "        btn.textContent = dark ? '‚òÄÔ∏è Svetl√Ω re≈æim' : 'üåô Tmav√Ω re≈æim';\n";
  htmlContent += "        localStorage.setItem('theme', dark ? 'dark' : 'light');\n";
  htmlContent += "      });\n";
  htmlContent += "      var originalQuestions = " + JSON.stringify(allQuestions) + ";\n";
  htmlContent += "      var questionCount = " + questionCount + ";\n";
  htmlContent += "      function shuffle(a){ for (var i=a.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1)); var t=a[i]; a[i]=a[j]; a[j]=t;} return a; }\n";
  htmlContent += "      function pick(a,n){ return shuffle(a.slice()).slice(0,n); }\n";
  htmlContent += "      // window.qs bude obsahova≈• presn√Ω poriadok a spr√°vne odpovede pre zobrazen√Ω test\n";
  htmlContent += "      window.qs = [];\n";
  htmlContent += "      function renderTest() {\n";
  htmlContent += "        var form = document.getElementById('quizForm'); form.innerHTML = '';\n";
  htmlContent += "        window.qs = pick(originalQuestions, Math.min(questionCount, originalQuestions.length))\n";
  htmlContent += "                  .map(function(q){ return { term: q.term, correct: q.correct, opts: shuffle([q.correct].concat(q.answers)) }; });\n";
  htmlContent += "        var nameField = document.createElement('input');\n";
  htmlContent += "        nameField.type = 'text'; nameField.id = 'studentName'; nameField.placeholder = 'Zadajte meno ≈æiaka'; nameField.style.width='350px';\n";
  htmlContent += "        form.appendChild(nameField);\n";
  htmlContent += "        window.qs.forEach(function(q,i){\n";
  htmlContent += "          var block = document.createElement('div'); block.className = 'question-block';\n";
  htmlContent += "          var title = document.createElement('div'); title.className = 'question-title';\n";
  htmlContent += "          title.textContent = (i+1) + '. ' + q.term;\n";
  htmlContent += "          block.appendChild(title);\n";
  htmlContent += "          var ansContainer = document.createElement('div'); ansContainer.className = 'answers';\n";
  htmlContent += "          q.opts.forEach(function(opt){\n";
  htmlContent += "            var lbl = document.createElement('label');\n";
  htmlContent += "            var rd = document.createElement('input'); rd.type = 'radio'; rd.name = 'q' + i; rd.value = opt;\n";
  htmlContent += "            lbl.appendChild(rd);\n";
  htmlContent += "            lbl.appendChild(document.createTextNode(' ' + opt));\n";
  htmlContent += "            ansContainer.appendChild(lbl);\n";
  htmlContent += "          });\n";
  htmlContent += "          block.appendChild(ansContainer);\n";
  htmlContent += "          form.appendChild(block);\n";
  htmlContent += "        });\n";
  htmlContent += "        var submitBtn = document.createElement('button');\n";
  htmlContent += "        submitBtn.type = 'button'; submitBtn.textContent = 'Odosla≈• odpovede';\n";
  htmlContent += "        submitBtn.onclick = evaluateTest;\n";
  htmlContent += "        form.appendChild(submitBtn);\n";
  htmlContent += "        var resultsDiv = document.createElement('div'); resultsDiv.id = 'results'; form.appendChild(resultsDiv);\n";
  htmlContent += "      }\n";
  htmlContent += "      function evaluateTest() {\n";
  htmlContent += "        var score = 0;\n";
  htmlContent += "        var blocks = document.getElementsByClassName('question-block');\n";
  htmlContent += "        Array.from(blocks).forEach(function(block, i){\n";
  htmlContent += "          var elems = document.getElementsByName('q' + i);\n";
  htmlContent += "          var selected = Array.from(elems).find(function(r){ return r.checked; });\n";
  htmlContent += "          Array.from(elems).forEach(function(r){\n";
  htmlContent += "            var lbl = r.parentNode;\n";
  htmlContent += "            if (r.value === window.qs[i].correct) lbl.classList.add('correct');\n";
  htmlContent += "            else if (r.checked) lbl.classList.add('incorrect');\n";
  htmlContent += "          });\n";
  htmlContent += "          var feedback = '';\n";
  htmlContent += "          if (!selected) {\n";
  htmlContent += "            block.classList.add('missing'); feedback = '‚ö†Ô∏è ch√Ωbaj√∫ca odpoveƒè';\n";
  htmlContent += "          } else if (selected.value === window.qs[i].correct) {\n";
  htmlContent += "            score++; feedback = '‚úÖ spr√°vna odpoveƒè';\n";
  htmlContent += "          } else {\n";
  htmlContent += "            feedback = '‚ùå nespr√°vna odpoveƒè';\n";
  htmlContent += "          }\n";
  htmlContent += "          var fbEl = document.createElement('div'); fbEl.style.fontWeight = 'bold'; fbEl.style.marginTop = '5px'; fbEl.textContent = feedback;\n";
  htmlContent += "          block.appendChild(fbEl);\n";
  htmlContent += "        });\n";
  htmlContent += "        var percent = Math.round(score / (window.qs.length || 1) * 100);\n";
  htmlContent += "        var name = document.getElementById('studentName').value || 'Nezn√°me meno';\n";
  htmlContent += "        var now = new Date().toLocaleString();\n";
  htmlContent += "        var out = document.getElementById('results');\n";
  htmlContent += "        out.innerHTML = `<h3>üìä V√Ωsledky testu</h3>\n";
  htmlContent += "          <p><strong>Meno ≈æiaka:</strong> ${name}</p>\n";
  htmlContent += "          <p><strong>Body:</strong> ${score} / ${window.qs.length}</p>\n";
  htmlContent += "          <p><strong>Percent√°:</strong> ${percent}%</p>\n";
  htmlContent += "          <p><strong>D√°tum a ƒças:</strong> ${now}</p>`;\n";
  htmlContent += "        var again = document.createElement('button');\n";
  htmlContent += "        again.type = 'button'; again.textContent = 'üîÅ Znova'; again.onclick = renderTest;\n";
  htmlContent += "        out.appendChild(again);\n";
  htmlContent += "      }\n";
  htmlContent += "      renderTest();\n";
  htmlContent += "    });\n";
  htmlContent += "  <\/script>\n";

  htmlContent += "  <br><br><b>Spracovala pomocou UI:</b> Mgr. Erika Matyiov√° (2025)<br><br>\n";
  htmlContent += "</body>\n</html>\n";

  // Stiahnutie
  const blob = new Blob([htmlContent], { type: "text/html" });
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement("a");
  a.href     = url;
  a.download = safeFileName;
  a.click();
  URL.revokeObjectURL(url);
}
</script>
<script>
// Umo≈æni vlo≈æenie tabul√°tora do textarea
    document.getElementById("inputData").addEventListener("keydown", function(e) {
      if (e.key === "Tab") {
        e.preventDefault();
        const textarea = this;
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;

        // Vlo≈æ tabul√°tor
        textarea.value = textarea.value.substring(0, start) + "\t" + textarea.value.substring(end);

        // Posu≈à kurzor
        textarea.selectionStart = textarea.selectionEnd = start + 1;
      }
    });
</script>
<script>
// Ukladanie a naƒç√≠tanie obsahu textarea do/z localStorage
const inputData = document.getElementById("inputData");

// pri naƒç√≠tan√≠ str√°nky obnov obsah
window.addEventListener("load", () => {
  const saved = localStorage.getItem("inputData");
  if (saved !== null) {
    inputData.value = saved;
  }
});

// pri ka≈ædej zmene ulo≈æ obsah
inputData.addEventListener("input", () => {
  localStorage.setItem("inputData", inputData.value);
});
</script>

<br><br>
  <b>Spracovala pomocou UI:</b> Mgr. Erika Matyiov√° (2025)
<br><br>
</body>
</html>