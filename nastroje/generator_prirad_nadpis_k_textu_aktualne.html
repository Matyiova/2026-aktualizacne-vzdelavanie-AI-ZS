<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generátor HTML cvičení - priradenie nadpisu k textu</title>
    <style>
        body {
            font-family: Courier bold, monospace;
            line-height: 1.6;
            background-color: #f4f7f6;
            color: #000000;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 25px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        h1 {
            text-align: center;
            color: #005a9c;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }
        label {
            display: block;
            font-weight: bold;
            margin-top: 20px;
            margin-bottom: 8px;
            color: #000000;
        }
        #dataInput {
            width: 100%;
            height: 350px;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-family: monospace;
            font-size: 16px;
            line-height: 1.5;
            resize: vertical;
            box-sizing: border-box;
            /* Aby padding neovplyvnil šírku */
        }
        #exerciseTitle {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        #generateBtn {
            display: block;
            width: 100%;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            background-color: #007bff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 25px;
            transition: background-color 0.3s ease;
        }
        #generateBtn:hover {
            background-color: #0056b3;
        }
        .instructions {
            background-color: #e6f7ff;
            border: 1px solid #b3e0ff;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
        }
        .instructions code {
            background-color: #d1ecff;
            padding: 2px 5px;
            border-radius: 3px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1 style="text-align": center;>Generátor HTML cvičení -<br>priradenie nadpisu/otázky k textu</h1>
        <p>Tento nástroj vygeneruje samostatnú HTML stránku s interaktívnym cvičením na priraďovanie.</p>

        <div class="instructions">
            <strong>Formát zadania:</strong><br>
            <code>Nadpis (otázka)</code><br>
            <code>(1 prázdny riadok)</code><br>
   
            <code>Súvislý text (odstavec)</code><br>
            <code>(2 prázdne riadky)</code><br>
            <code>Ďalší nadpis...</code>
        </div>

         <label for="exerciseTitle" style="display: inline-block; font-size: 120%; margin-right: 10px;">Názov cvičenia:</label>
		<input type="text" id="exerciseTitle" style="width: 800px;"
		placeholder="Zadajte názov cvičenia.">
		

        <label for="dataInput"><span style="font-size: 120%;">Vstupné údaje:</span></label>
        <textarea id="dataInput" placeholder="Kedy si sa začal venovať futbalu?

Futbalu som sa začal venovať, keď som mal 3 roky. Viedol ma k tomu otec.


Dokedy by si chcel hrať futbal profesionálne?

Na túto otázku sa mi odpovedá ťažko. Uvidíme, čo prinesie život, aké bude moje zdravie, moja kondícia."></textarea>

        <button id="generateBtn" style="width: 300px;">Vygenerovať HTML stránku</button>
    </div>

    <script>
        const dataInput = document.getElementById('dataInput');
        const exerciseTitleInput = document.getElementById('exerciseTitle');
        const generateBtn = document.getElementById('generateBtn');

        // --- LocalStorage ---

        // Načítať dáta z localStorage pri otvorení stránky
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('exerciseGeneratorInput');
            if (savedData) {
                dataInput.value = savedData;
            }
            
            // Pridané pre názov cvičenia
            const savedTitle = localStorage.getItem('exerciseGeneratorTitle');
            if (savedTitle) {
                exerciseTitleInput.value = savedTitle;
            }
        }

        // Uložiť dáta do localStorage pri každej zmene
        function saveToLocalStorage() {
            localStorage.setItem('exerciseGeneratorInput', dataInput.value);
        }

        // Pridaná funkcia pre uloženie názvu
        function saveTitleToLocalStorage() {
            localStorage.setItem('exerciseGeneratorTitle', exerciseTitleInput.value);
        }

        dataInput.addEventListener('input', saveToLocalStorage);
        exerciseTitleInput.addEventListener('input', saveTitleToLocalStorage); // Pridaný listener
        window.addEventListener('load', loadFromLocalStorage);
        
        // --- Generátor ---

        generateBtn.addEventListener('click', () => {
            const rawText = dataInput.value;
            const exerciseTitle = exerciseTitleInput.value || "Moje cvičenie"; // Defaultný názov
            const data = parseInput(rawText);

            if (data.length === 0) {
                alert("Nenašli sa žiadne platné dáta. Skontrolujte formát vstupu.\n\nFormát je:\nOtázka\n\nOdpoveď\n\n\nĎalšia otázka...");
                return;
            }

            const exerciseHTML = createExerciseHTML(exerciseTitle, data);
            downloadHTML(exerciseHTML, exerciseTitle);
        });
        
        /**
         * Parsovanie vstupného textu na dátovú štruktúru.
         */
        function parseInput(text) {
            const data = [];
            // Rozdelí text na bloky podľa 2+ prázdnych riadkov (3+ nové riadky)
            const blocks = text.trim().split(/\n\n\n+/);
            
            for (const block of blocks) {
                // Rozdelí blok na nadpis a text podľa 1 prázdneho riadku (2 nové riadky)
                // Použijeme limit 2, aby sa rozdelilo len na prvom výskyte \n\n
                const parts = block.trim().split(/\n\n/);
                
                if (parts.length >= 2) {
                    const heading = parts[0].trim();
                    // Spojí zvyšné časti, ak by odstavec obsahoval prázdny riadok
                    const paragraph = parts.slice(1).join('\n\n').trim();
                    
                    if (heading && paragraph) {
                        data.push({ heading, paragraph });
                    }
                }
            }
            return data;
        }

        /**
         * Vytvorí a ponúkne na stiahnutie finálny HTML súbor.
         */
        function downloadHTML(htmlContent, title) {
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const a = document.createElement('a');
            
            // Vytvorí bezpečný názov súboru
            const slug = title.toLowerCase()
                .replace(/[^a-z0-9\s-]/g, '') // Odstráni špeciálne znaky
                .replace(/[\s-]+/g, '_')     // Nahradí medzery a pomlčky jednou pomlčkou
                .replace(/^-+|-+$/g, '');
            // Odstráni pomlčky na začiatku a konci
                
            a.href = URL.createObjectURL(blob);
            a.download = (slug || 'cvicenie') + '.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(a.href);
        }

        /**
         * Funkcia na escapovanie HTML, aby sa predišlo XSS alebo chybám pri zobrazení.
         */
        function escapeHTML(str) {
            if (typeof str !== 'string') return '';
            return str.replace(/[&<>"']/g, function(m) {
                return {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                }[m];
            });
        }

        /**
         * Hlavná funkcia, ktorá generuje kód finálnej HTML stránky.
         * Toto je šablóna pre cvičenie.
         */
        function createExerciseHTML(title, data) {
            // Unikátne ID pre páry, aby sme ich vedeli spárovať
            const indexedData = data.map((item, index) => ({
                ...item,
                id: `pair-${index}`
            }));

            const jsonData = JSON.stringify(indexedData);
            const escapedTitle = escapeHTML(title);
            
            // Template literal pre celú HTML stránku cvičenia
            // **OPRAVA:** Značky <\/script> sú "rozbité", aby ich prehliadač nespracoval predčasne.
            return `
<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${escapedTitle}</title>
    <style>
        body {
            font-family: Courier bold, monospace;
            line-height: 1.2;
            background-color: #f8f9fa;
            color: #212529;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 25px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        h1 {
            color: #005a9c;
            text-align: center;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 15px;
        }
        
        /* Formulár pre meno */
        .student-info {
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .student-info label {
            font-weight: bold;
            font-size: 1.1em;
            color: #333;
        }
        #studentName {
            flex-grow: 1;
            padding: 10px 12px;
            font-size: 1em;
            border: 1px solid #ced4da;
            border-radius: 5px;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.07);
        }

        /* Hlavný kontajner cvičenia */
        #exerciseContainer {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-top: 20px;
        }

        /* 1. Odstavce (ľavá strana) */
        #paragraphsContainer {
            flex: 2;
            /* Bude 2x širší ako nadpisy */
            min-width: 450px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .paragraph-item {
            display: flex;
            align-items: flex-start; /* Zarovná slot a text nahor */
            gap: 15px;
            padding: 10px;
            background-color: #fdfdfd;
            border: 1px solid #e9ecef;
            border-radius: 5px;
        }
        .slot {
            flex-shrink: 0;
            /* Slot sa nezmenší */
            width: 300px;
            min-height: 45px;
            background-color: #e9ecef;
            border: 2px dashed #adb5bd;
            border-radius: 5px;
            padding: 5px;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .slot.drop-target { /* Keď je vybraný nadpis, zvýrazní sa slot */
            border-color: #007bff;
            background-color: #e6f7ff;
        }
        .paragraph-item p {
            flex-grow: 1;
            margin: 0;
            padding-top: 5px; /* Lepšie zarovnanie s textom v slote */
            white-space: pre-wrap;
            /* Zachová formátovanie odstavca (nové riadky) */
        }

        /* 2. Nadpisy (pravá strana) */
        #headingsContainer {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 15px;
            background-color: #f1f3f5;
			font-weight: bold;
            border-radius: 5px;
            border: 1px solid #dee2e6;
            align-self: flex-start; /* Zostane hore */
        }
        .heading-item {
            padding: 10px 15px;
            background-color: #fff;
            border: 1px solid #ced4da;
            border-radius: 5px;
            cursor: pointer;
            user-select: none;
            /* Zabraňuje označeniu textu */
            transition: background-color 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .heading-item:hover {
            background-color: #f8f9fa;
        }
        .heading-item.selected {
            background-color: #007bff;
            color: white;
            border-color: #0056b3;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .heading-item.placed { /* Keď je v slote */
            cursor: default;
            background-color: #fff;
            color: #333;
            border-color: #ced4da;
			font-weight: bold;
        }
        .slot .heading-item { /* Vložený nadpis */
            margin: 0;
            box-shadow: none;
            cursor: grab; /* Naznačuje možnosť presunutia */
        }
        .slot .heading-item:hover {
            background-color: #fef4f4;
            /* Mierne červená pre indikáciu odobratia */
            border-color: #e57373;
        }

        /* *** OPRAVENÉ ŠTÝLY PRE VYHODNOTENIE *** */
        /* Zvýšená špecificita pridaním .slot */
        .slot .heading-item.evaluated-correct {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
            cursor: default;
			font-weight: bold;
        }
        .slot .heading-item.evaluated-incorrect {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
            cursor: default;
			font-weight: bold;
        }
        /* Po vyhodnotení zrušíme hover efekt na vrátenie */
        .slot .heading-item.evaluated-correct:hover {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        .slot .heading-item.evaluated-incorrect:hover {
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        /* *** KONIEC OPRAVENÝCH ŠTÝLOV *** */


        /* Tlačidlá */
        .button-container {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }
        #evaluateBtn {
            padding: 12px 30px;
            font-size: 1.1em;
            font-weight: bold;
            color: #fff;
            background-color: #28a745;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #evaluateBtn:hover {
            background-color: #218838;
        }
        #evaluateBtn:disabled {
            background-color: #adb5bd;
            cursor: not-allowed;
        }

        /* Zhrnutie výsledkov */
        #summary {
            margin-top: 30px;
            background-color: #e6f7ff;
            border: 1px solid #b3e0ff;
            border-radius: 8px;
            padding: 20px;
            display: none;
            /* Skryté, kým sa nevyhodnotí */
        }
        #summary h2 {
            margin-top: 0;
            color: #005a9c;
        }
        #summary p {
            font-size: 1.1em;
            margin: 8px 0;
        }
        #summary strong {
            color: #333;
        }
        #detailBtn {
            padding: 10px 20px;
            font-size: 1em;
            color: #fff;
            background-color: #007bff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 15px;
            transition: background-color 0.3s;
        }
        #detailBtn:hover {
            background-color: #0056b3;
        }

        /* Štýly pre detailnú stránku (v novom okne) */
        .results-window body {
            font-family: Courier bold, monospace;
            padding: 20px;
            line-height: 1.5;
        }
        .results-window h1 {
            color: #005a9c;
            border-bottom: 2px solid #ccc;
            padding-bottom: 10px;
        }
        .results-window h2 {
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .results-window .summary-details p {
            font-size: 1.1em;
        }
        .results-window table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .results-window th, .results-window td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            vertical-align: top;
            white-space: pre-wrap; /* Zachová formátovanie v tabuľke */
        }
        .results-window th {
            background-color: #f4f4f4;
            font-weight: bold;
        }
        .results-window tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .results-window .symbol {
            font-size: 1.3em;
            font-weight: bold;
            margin-left: 10px;
        }
        .results-window .correct { color: #28a745;
        }
        .results-window .incorrect { color: #dc3545;
        }
        .results-window .legend {
            margin-top: 20px;
            font-size: 0.9em;
            color: #555;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>${escapedTitle}</h1>

        <div class="student-info">
            <label for="studentName">Meno žiaka:</label>
            <input type="text" id="studentName" placeholder="Zadajte meno žiaka.">
        </div>

        <div id="exerciseContainer">
            <div id="paragraphsContainer">
                 </div>
            <div id="headingsContainer">
                </div>
        </div>

        <div class="button-container">
            <button id="evaluateBtn">Vyhodnotiť</button>
        </div>

        <div id="summary">
            <h2>Výsledky cvičenia</h2>
    
            <p><strong>Názov cvičenia:</strong> <span id="summaryTitle"></span></p>
            <p><strong>Meno žiaka:</strong> <span id="summaryName"></span></p>
            <p><strong>Hodnotenie:</strong> <span id="summaryScore"></span></p>
            <p><strong>Dátum a čas:</strong> <span id="summaryDateTime"></span></p>
            <button id="detailBtn">Detailné výsledky</button>
        </div>
    </div>

    <script id="exerciseData" type="application/json">
        ${jsonData}
    </` + `script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Globálne premenné ---
            const data = JSON.parse(document.getElementById('exerciseData').textContent);
            const paragraphsContainer = document.getElementById('paragraphsContainer');
            const headingsContainer = document.getElementById('headingsContainer');
            const evaluateBtn = document.getElementById('evaluateBtn');
            const detailBtn = document.getElementById('detailBtn');
            const studentNameInput = document.getElementById('studentName');
            let selectedHeadingElement = null;
            let detailedResultsData = []; // Uchováva dáta pre detailný prehľad
            let evaluationDone = false;
            
            // --- Pomocné funkcie ---

            /**
             * Funkcia na náhodné premiešanie poľa (Fisher-Yates shuffle).
             */
            function shuffleArray(array) {
                let currentIndex = array.length, randomIndex;
                while (currentIndex != 0) {
                    randomIndex = Math.floor(Math.random() * currentIndex);
                    currentIndex--;
                    [array[currentIndex], array[randomIndex]] = [
                        array[randomIndex], array[currentIndex]];
                }
                return array;
            }
            
            /**
             * Funkcia na bezpečné vloženie textu.
             */
            function safeSetHTML(element, text) {
                element.textContent = text;
            }

            // --- Inicializácia cvičenia ---

            function initializeExercise() {
                // 1. Vytvoriť náhodné poradie pre odstavce a nadpisy
                const shuffledParagraphs = shuffleArray([...data]);
                const shuffledHeadings = shuffleArray([...data]);

                // 2. Vytvoriť a vložiť odstavce so slotmi
                paragraphsContainer.innerHTML = '';
                // Vyčistiť pre istotu
                shuffledParagraphs.forEach(item => {
                    const paraItem = document.createElement('div');
                    paraItem.className = 'paragraph-item';
                    
              
                    const slot = document.createElement('div');
                    slot.className = 'slot';
                    // Kľúčový údaj: slot vie, ktorý ID je preň správny
                    slot.dataset.correctId = item.id;
                  
   
                    const para = document.createElement('p');
                    safeSetHTML(para, item.paragraph); // Bezpečné vloženie textu
                    
                    paraItem.appendChild(slot);
          
                    paraItem.appendChild(para);
                    paragraphsContainer.appendChild(paraItem);
                });
                
                // 3. Vytvoriť a vložiť nadpisy
                headingsContainer.innerHTML = '';
                // Vyčistiť
                shuffledHeadings.forEach(item => {
                    const headingItem = document.createElement('div');
                    headingItem.className = 'heading-item';
                    headingItem.dataset.id = item.id;
              
                    safeSetHTML(headingItem, item.heading); // Bezpečné vloženie textu
                    headingsContainer.appendChild(headingItem);
                });
                
                // 4. Pridať Event Listeners
                addEventListeners();
            }

            // --- Logika presúvania (Click & Click) ---

            function addEventListeners() {
                // Kliknutie na nadpis (na výber)
                headingsContainer.addEventListener('click', handleHeadingClick);
                // Kliknutie na slot (pre umiestnenie)
                paragraphsContainer.addEventListener('click', handleSlotClick);
                // Dvojklik na vrátenie nadpisu
                paragraphsContainer.addEventListener('dblclick', handleItemReturn);
                // Vyhodnotenie
                evaluateBtn.addEventListener('click', evaluateExercise);
                // Detailné výsledky
                detailBtn.addEventListener('click', showDetailedResults);
            }

            function handleHeadingClick(e) {
                if (evaluationDone) return;
                // Po vyhodnotení sa nedá klikať
                
                const clickedItem = e.target.closest('.heading-item');
                if (!clickedItem) return;

                // Ak už je nejaký vybraný, od-vyber ho
                if (selectedHeadingElement) {
                    selectedHeadingElement.classList.remove('selected');
                    toggleDropTargetSlots(false); // Vypni zvýraznenie slotov
                }

                // Ak klikáme na ten istý, len ho od-vyberieme
                if (selectedHeadingElement === clickedItem) {
                    selectedHeadingElement = null;
                } else {
                    // Vyber nový
                    selectedHeadingElement = clickedItem;
                    selectedHeadingElement.classList.add('selected');
                    toggleDropTargetSlots(true); // Zapni zvýraznenie slotov
                }
            }

            function handleSlotClick(e) {
                if (evaluationDone) return;
                const clickedSlot = e.target.closest('.slot');
                
                // Ak máme vybraný nadpis a klikli sme na slot
                if (selectedHeadingElement && clickedSlot) {
                    // Ak je slot prázdny, vložíme
                    if (clickedSlot.children.length === 0) {
                  
                        clickedSlot.appendChild(selectedHeadingElement);
                        selectedHeadingElement.classList.remove('selected');
                        selectedHeadingElement.classList.add('placed'); // Pridá triedu, že je umiestnený
                        selectedHeadingElement = null;
                        toggleDropTargetSlots(false); // Vypni zvýraznenie
                    }
                    // Ak slot nie je prázdny, neurobíme nič (vrátenie je cez dblclick)
                }
            }
            
      
            function handleItemReturn(e) {
                if (evaluationDone) return;
                // Po vyhodnotení sa nedá dblclick-núť

                const clickedItem = e.target.closest('.heading-item');
                // Ak sme dvojklikli na item, ktorý je v slote
                if (clickedItem && clickedItem.parentElement.classList.contains('slot')) {
                    clickedItem.classList.remove('placed');
                    headingsContainer.appendChild(clickedItem); // Vráti ho do zoznamu
                    
                    // Ak bol náhodou práve vybraný, zrušíme výber
                    if (selectedHeadingElement === clickedItem) {
                        
                        selectedHeadingElement = null;
                        toggleDropTargetSlots(false);
                    }
                }
            }
            
            /**
             * Zvýrazní/Odznačí prázdne sloty ako cieľ.
             */
            function toggleDropTargetSlots(highlight) {
                document.querySelectorAll('.slot').forEach(slot => {
                    if (slot.children.length === 0) { // Iba prázdne sloty
                        slot.classList.toggle('drop-target', highlight);
               
                     }
                });
            }

            // --- Vyhodnotenie ---

            function evaluateExercise() {
                // Skontrolujeme, či sú všetky sloty plné
                const allSlots = document.querySelectorAll('.slot');
                const allFilled = [...allSlots].every(slot => slot.children.length > 0);

                if (!allFilled) {
                    alert('Prosím, priraďte všetky nadpisy k odstavcom predtým, než cvičenie vyhodnotíte.');
                    return;
                }
                
                // Zablokujeme ďalšie úpravy
                evaluationDone = true;
                evaluateBtn.disabled = true;
                if (selectedHeadingElement) {
                    selectedHeadingElement.classList.remove('selected');
                    selectedHeadingElement = null;
                    toggleDropTargetSlots(false);
                }

                let score = 0;
                const total = data.length;
                detailedResultsData = []; // Resetujeme výsledky
                
                // Mapa pre rýchle nájdenie dát podľa ID
                const dataMap = new Map(data.map(item => [item.id, item]));
                
                allSlots.forEach(slot => {
                    const correctId = slot.dataset.correctId;
                    const correctItem = dataMap.get(correctId);
                    
                    const placedItemEl = slot.querySelector('.heading-item');
         
                    const studentAnswerId = placedItemEl.dataset.id;
                    const studentAnswerItem = dataMap.get(studentAnswerId);
                    
                    let isCorrect = (correctId === studentAnswerId);
                  
   
                    // *** Logika pre farby ***
                    placedItemEl.classList.remove('placed'); // Odstráni štýl 'umiestnený'
                    if (isCorrect) {
                        score++;
   
                        placedItemEl.classList.add('evaluated-correct'); // Pridá zelenú
                    } else {
                        placedItemEl.classList.add('evaluated-incorrect'); // Pridá červenú
                    }
       
                     
                    // Uložíme dáta pre detailný report
                    detailedResultsData.push({
                        paragraph: correctItem.paragraph,
                 
                        correctHeading: correctItem.heading,
                        studentAnswer: studentAnswerItem.heading,
                        isCorrect: isCorrect
                    });
                });

                const percentage = (score / total) * 100;
                const studentName = studentNameInput.value.trim() || "Anonym";
                const dateTime = new Date().toLocaleString('sk-SK');
                
                // Zobraziť súhrn
                showSummary(studentName, score, total, percentage, dateTime);
            }

            function showSummary(name, score, total, percentage, dateTime) {
                document.getElementById('summaryTitle').textContent = '${escapedTitle}';
                document.getElementById('summaryName').textContent = name;
                document.getElementById('summaryScore').textContent = \`\${score} z \${total} správne (\${percentage.toFixed(1)} %)\`;
                document.getElementById('summaryDateTime').textContent = dateTime;
                
                document.getElementById('summary').style.display = 'block';
                // Scroll na výsledky
                document.getElementById('summary').scrollIntoView({ behavior: 'smooth' });
            }

            // --- Detailné výsledky ---
            
            function showDetailedResults() {
                const studentName = document.getElementById('summaryName').textContent;
                const scoreText = document.getElementById('summaryScore').textContent;
                const dateTime = document.getElementById('summaryDateTime').textContent;

                const newWindow = window.open('', '_blank');
                newWindow.document.write(createResultsPageHTML(studentName, scoreText, dateTime));
                newWindow.document.close();
            }
            
            // Pomocná funkcia na escapovanie pre detailný report
            function escapeForHTML(str) {
                if (typeof str !== 'string') return '';
                const p = document.createElement('p');
                p.textContent = str;
                return p.innerHTML.replace(/\\n/g, '<br>');
                // Zachová nové riadky
            }
            
            function createResultsPageHTML(studentName, scoreText, dateTime) {
                let tableRows = '';
                
                detailedResultsData.forEach(res => {
                    const symbol = res.isCorrect 
                        ? '<span class="symbol correct">&#10003;</span>' // Fajka
                        : '<span class="symbol incorrect">&#10007;</span>'; // Krížik
                
     
                    tableRows += \`
                        <tr>
                            <td>\${escapeForHTML(res.paragraph)}</td>
                      
                            <td>\${escapeForHTML(res.correctHeading)}</td>
                            <td>\${escapeForHTML(res.studentAnswer)} \${symbol}</td>
                        </tr>
                    \`;
                });
                
                return \`
                    <!DOCTYPE html>
                    <html lang="sk">
                    <head>
                        <meta charset="UTF-8">
            
                        <title>Detailné výsledky - ${escapedTitle}</title>
                        <style>
                            /* Tu sa vkladajú CSS štýly pre tlač/zobrazenie */
                         
                            body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.5; }
                            h1 { color: #005a9c; border-bottom: 2px solid #ccc; padding-bottom: 10px; }
                            h2 { color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px; }
                            .summary-details p { font-size: 1.1em; margin: 5px 0; }
                            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                            th, td { border: 1px solid #ddd; padding: 10px; text-align: left; vertical-align: top; white-space: pre-wrap; }
                            th { background-color: #f4f4f4; font-weight: bold; }
                            tr:nth-child(even) { background-color: #f9f9f9; }
                            .symbol { font-size: 1.3em; font-weight: bold; margin-left: 10px; }
                            .correct { color: #28a745; }
                            .incorrect { color: #dc3545; }
                            .legend { margin-top: 20px; font-size: 0.9em; color: #555; }
                            
                            @media print {
                                body { padding: 0; margin: 20px; }
                                h1, h2, table, .legend { page-break-inside: avoid; }
                                .summary-details { page-break-after: avoid; }
                                tr { page-break-inside: avoid; }
                                a { text-decoration: none; color: #000; }
                                .symbol { -webkit-print-color-adjust: exact; color-adjust: exact; }
                                .correct { color: #28a745 !important; }
                                .incorrect { color: #dc3545 !important; }
                            }
                        </style>
                    </head>
                    <body class="results-window">
       
                        <h1>Detailné výsledky</h1>
                        
                        <div class="summary-details">
                            <p><strong>Názov cvičenia:</strong> ${escapedTitle}</p>
   
                            <p><strong>Meno žiaka:</strong> \${escapeForHTML(studentName)}</p>
                            <p><strong>Hodnotenie:</strong> \${escapeForHTML(scoreText)}</p>
                            <p><strong>Dátum a čas:</strong> \${escapeForHTML(dateTime)}</p>
             
                        </div>

                        <h2>Detailný prehľad</h2>
                        <table>
                            <thead>
            
                                <tr>
                                    <th>Text (Odstavec)</th>
                                    <th>Správny nadpis (otázka)</th>
     
                                    <th>Odpoveď žiaka</th>
                                </tr>
                            </thead>
        
                            <tbody>
                                \${tableRows}
                            </tbody>
                    
                        </table>
                        
                        <div class="legend">
                            <p><strong>Vysvetlivky:</strong><br>
                   
                                <span class="symbol correct">&#10003;</span> = Správna odpoveď<br>
                                <span class="symbol incorrect">&#10007;</span> = Nesprávna odpoveď
                            </p>
                 
                        </div>
                    </body>
                    </html>
                \`;
            }

            // --- Štart ---
            initializeExercise();
        });
    <\/` + `script>
	<br><br>
  <b>Spracovala pomocou UI:</b> Mgr. Erika Matyiová (2025)
  <br><br>
</body>
</html>
`;
        } // Koniec funkcie createExerciseHTML

    </script>
<br><br>
  <b>Spracovala pomocou UI:</b> Mgr. Erika Matyiová (2025)
<br><br>
</body>
</html>