<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="utf-8">
<title>Gener√°tor cviƒçen√≠ na slovosled (Verzia pre tlaƒç - ƒçiernobiela)</title>
<style>
body { font-family: Courier bold, monospace; max-width: 1000px; margin: 2em auto; padding: 0 1em; }
textarea, input[type="text"], input[type="number"] { width: 100%; padding: .5em; margin-bottom: 1em; font-family: monospace; box-sizing: border-box; }
button { padding: .5em 1em; background: #007BFF; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: .5em; }
button:hover { background: #005bb5; }
label { font-weight: bold; display: block; margin-top: 1em; }
#preview { margin-top: 2em; border-top: 2px solid #ccc; padding-top: 2em; }
iframe { width: 100%; height: 800px; border: 1px solid #ccc; }
.controls { margin-top: .5em; }
.row { display: flex; gap: 20px; }
.col { flex: 1; }
.note { font-size: 0.9em; color: #666; margin-top: -0.8em; margin-bottom: 1em; }
</style>
</head>
<body>
<h1>Gener√°tor cviƒçen√≠ na slovosled</h1>
<p><i>Verzia: Nastaviteƒæn√Ω limit vo vn√∫tri + bodovanie slov + ƒçiernobiela tlaƒç (symboly).</i></p>

<label for="title">N√°zov cviƒçenia:</label>
<input type="text" id="title" placeholder="Zoradenie slov vo vete">

<div class="row">
  <div class="col">
    <label for="student">Meno ≈æiaka (predvolen√©):</label>
    <input type="text" id="student" placeholder="Zadaj meno ≈æiaka (nepovinn√©)">
  </div>
</div>

<label for="input">Zadajte vety (jednotliv√© polo≈æky oddeƒæte TAB alebo dvomi medzerami, alternat√≠vy oddeƒæte "//", jednotliv√© vety oddeƒæte pr√°zdnym riadkom):</label>
<textarea id="input" rows="10" placeholder="Kedy[TAB]pr√≠de≈°[TAB]domov[TAB]?&#10;&#10;Preƒço  si  nebol  v pondelok  v ≈°kole?//Preƒço  si  v pondelok  nebol  v ≈°kole?"></textarea>

<div class="controls">
  <button id="genBtn">Vygenerova≈• cviƒçenie</button>
  <button id="openWinBtn">Otvori≈• v novom okne</button>
  <button id="saveBtn">üíæ Ulo≈æi≈• cviƒçenie ako HTML</button>
</div>

<iframe id="previewFrame" title="N√°hƒæad cviƒçenia"></iframe>

<script>
/* ---------- LocalStorage pre Gener√°tor ---------- */
window.addEventListener("load", () => {
  document.getElementById("title").value = localStorage.getItem("sv_title") || "";
  document.getElementById("student").value = localStorage.getItem("sv_student") || "";
  document.getElementById("input").value = localStorage.getItem("sv_input") || "";
});

["title","student","input"].forEach(id => {
  document.getElementById(id).addEventListener("input", () => {
    localStorage.setItem("sv_" + id, document.getElementById(id).value);
  });
});

/* ---------- Generovanie d√°t ---------- */
function parseInput(text) {
  if (!text || !text.trim()) return [];
  const blocks = text.trim().split(/\r?\n\s*\r?\n/);
  return blocks.map(block => block.split('//').map(v =>
    v.trim().split(/\t| {2,}/).map(w => w.trim()).filter(Boolean)
  ));
}
function escapeHtml(s) {
  return String(s||'').replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
}

/* ---------- Generovanie HTML ---------- */
function buildExerciseHTML(title, student, data) {
return `<!DOCTYPE html><html lang="sk"><head><meta charset="utf-8"><title>${escapeHtml(title)}</title>
<style>
body{font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width:900px; margin:2em auto; padding:0 1em; background-color: #fdfdfd;}
h1 { text-align: center; color: #333; }
.info-panel { background: #eee; padding: 15px; border-radius: 5px; margin-bottom: 20px; display: flex; flex-wrap: wrap; align-items: center; gap: 15px; justify-content: space-between; }
.student-input { font-size: 1em; padding: 5px; border: 1px solid #aaa; border-radius: 3px; width: 200px; }

/* Settings panel styles */
.settings-box { font-size: 0.9em; display: flex; align-items: center; gap: 10px; background: #e2e6ea; padding: 5px 10px; border-radius: 4px; border: 1px solid #ccc; }
.settings-box input { width: 60px; padding: 3px; text-align: center; }

.slot{display:inline-flex; align-items:center; justify-content:center; min-width:2em; min-height:1.8em; border-bottom: 2px solid #555; padding:.2em .4em; margin:.2em; flex-shrink:0; white-space:nowrap; background: #fff; font-weight: bold; position: relative; border-radius: 3px; transition: background 0.3s; }
.slots{display:flex; flex-wrap:wrap; gap:.5em; margin-bottom:1.5em; min-height: 50px; align-items: center;}
.card{display:inline-block; background:#fff; padding:.5em 1em; margin:.3em; border:1px solid #aaa; border-radius:4px; cursor:pointer; user-select:none; box-shadow: 0 2px 4px rgba(0,0,0,0.1);}
.card:hover { background: #f0f8ff; border-color: #007BFF; }
.card.selected{background:#cfe5ff; border-color: #0056b3;}

/* Evaluation styles (On Screen only - colors remain for interactive mode) */
.slot.correct { background-color: #d4edda; border-bottom-color: #28a745; color: #155724; }
.slot.incorrect { background-color: #f8d7da; border-bottom-color: #dc3545; color: #721c24; }

.task { display: none; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background: white; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
.task.active { display: block; }
.nav-buttons { margin-top: 2em; text-align: center; }
.main-btn { padding: 10px 20px; font-size: 1.1em; background: #007BFF; color: white; border: none; border-radius: 5px; cursor: pointer; }
.main-btn:hover { background: #005bb5; }
.main-btn:disabled { background: #ccc; cursor: default; }
.pagination { margin-top: 15px; display: flex; justify-content: center; gap: 5px; flex-wrap: wrap;}
.page-btn { padding: 5px 10px; border: 1px solid #ccc; background: white; cursor: pointer; border-radius: 3px; }
.page-btn.active { background: #007BFF; color: white; border-color: #007BFF; }
.page-btn.solved { background: #d4edda; color: #155724; border-color: #c3e6cb; }
.page-btn.solved:hover:not(.active) { background: #c3e6cb; }
.page-btn:hover:not(.active) { background: #f0f0f0; }

/* Status icons */
.status-score { margin-left: 10px; font-weight: bold; font-size: 1.1em; color: #007BFF; background: #eef; padding: 2px 8px; border-radius: 4px; }

/* Results section */
#finalSummary { display: none; margin-top: 2em; padding: 20px; background: #f9f9f9; border: 2px solid #007BFF; border-radius: 8px; }
.summary-line { margin: 10px 0; font-size: 1.1em; }
.detail-btn { background: #28a745; margin-top: 10px; }
.detail-btn:hover { background: #218838; }

@media print{ button, .nav-buttons, .card, .settings-box { display:none!important; } body { max-width: 100%; } .info-panel { background: none; border: none; padding: 0; } .student-input { border: none; font-weight: bold; padding: 0; } }
</style></head><body>

<h1>${escapeHtml(title)}</h1>
<div class="info-panel">
  <div>
    <label for="studentName"><b>Meno ≈æiaka:</b></label>
    <input type="text" id="studentName" class="student-input" value="${escapeHtml(student)}" placeholder="Sem nap√≠≈° svoje meno">
  </div>
  
  <div class="settings-box">
    <label for="limitInput">Poƒçet viet:</label>
    <input type="number" id="limitInput" min="0" value="0" title="0 = v≈°etky vety">
    <button onclick="applyLimit()" style="font-size:0.8em; padding: 3px 8px; margin:0;">Pou≈æi≈• a re≈°tartova≈•</button>
  </div>
</div>

<div id="instruction" style="text-align:center; margin-bottom:1em; color:#555;">
  Klikni na slovo v z√°sobn√≠ku a n√°sledne na pr√°zdnu ƒçiaru vo vete.<br>
  Kliknut√≠m na vlo≈æen√© slovo ho vr√°ti≈° sp√§≈•.
</div>

<div id="tasksContainer"></div>

<div class="nav-buttons" id="navControls">
  <button id="nextBtn" class="main-btn">ƒéalej</button>
  <button id="evalBtn" class="main-btn" style="display:none;">Vyhodnoti≈•</button>
  <div class="pagination" id="pagination"></div>
</div>

<div id="finalSummary">
  <h2 style="margin-top:0">V√Ωsledky cviƒçenia</h2>
  <div class="summary-line"><b>N√°zov cviƒçenia:</b> ${escapeHtml(title)}</div>
  <div class="summary-line"><b>Meno ≈æiaka:</b> <span id="resName"></span></div>
  <div class="summary-line"><b>Z√≠skan√© body:</b> <span id="resScore"></span></div>
  <div class="summary-line"><b>√öspe≈°nos≈•:</b> <span id="resPercent"></span></div>
  <div class="summary-line"><b>D√°tum a ƒças:</b> <span id="resTime"></span></div>
  <button id="detailBtn" class="main-btn detail-btn">Detailn√© v√Ωsledky (Tlaƒç)</button>
</div>

<script>
// Funkcia na mie≈°anie poƒæa
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

// D√°ta z gener√°tora
let fullData = ${JSON.stringify(data)};
let activeData = [];

// --- Spr√°va limitu (LocalStorage) ---
const STORAGE_KEY_LIMIT = 'sv_limit_' + window.location.pathname.split('/').pop(); 
function loadLimit() {
  const saved = localStorage.getItem(STORAGE_KEY_LIMIT);
  return saved ? parseInt(saved, 10) : 0;
}

function applyLimit() {
  const val = parseInt(document.getElementById('limitInput').value, 10) || 0;
  localStorage.setItem(STORAGE_KEY_LIMIT, val);
  location.reload();
}

// Inicializ√°cia d√°t
const userLimit = loadLimit();
document.getElementById('limitInput').value = userLimit;

// Pr√≠prava ot√°zok
activeData = shuffle([...fullData]); 
if (userLimit > 0 && userLimit < activeData.length) {
  activeData = activeData.slice(0, userLimit);
}

const taskContainer = document.getElementById('tasksContainer');
const pagContainer = document.getElementById('pagination');
const nextBtn = document.getElementById('nextBtn');
const evalBtn = document.getElementById('evalBtn');
const navControls = document.getElementById('navControls');
const finalSummary = document.getElementById('finalSummary');
const instruction = document.getElementById('instruction');

let currentTaskIndex = 0;
let isEvaluated = false;

// --- Helper pre kontrolu dokonƒçenia √∫lohy ---
function checkAndMarkPage(taskIndex) {
    if (!pagContainer.children[taskIndex]) return; 
    const taskEl = taskContainer.children[taskIndex];
    const slots = taskEl.querySelectorAll('.slot');
    const allSlotsFilled = [...slots].every(s => s.dataset.value); 
    const pageButton = pagContainer.querySelector(\`.page-btn:nth-child(\${taskIndex + 1})\`);
    if (pageButton) pageButton.classList.toggle('solved', allSlotsFilled);
}

// --- Vykreslenie √∫loh ---
activeData.forEach((vars, idx) => {
  const ref = vars[0];
  
  const t = document.createElement('div');
  t.className = 'task';
  t.dataset.idx = idx;
  if(idx === 0) t.classList.add('active');

  const h = document.createElement('h3');
  h.textContent = '√öloha ' + (idx + 1) + ' / ' + activeData.length;
  t.appendChild(h);

  const slotsDiv = document.createElement('div');
  slotsDiv.className = 'slots';
  ref.forEach(() => {
    const s = document.createElement('div');
    s.className = 'slot';
    slotsDiv.appendChild(s);
  });
  t.appendChild(slotsDiv);

  const cardsDiv = document.createElement('div');
  cardsDiv.className = 'cards-area';
  shuffle(ref.slice()).forEach(w => {
    const c = document.createElement('div');
    c.className = 'card';
    c.textContent = w;
    cardsDiv.appendChild(c);
  });
  t.appendChild(cardsDiv);

  taskContainer.appendChild(t);

  let sel = null;
  
  cardsDiv.addEventListener('click', e => {
    if(isEvaluated) return;
    const c = e.target.closest('.card'); if(!c) return;
    if(sel) sel.classList.remove('selected');
    if(sel === c) { sel = null; return; }
    sel = c; 
    sel.classList.add('selected');
  });

  slotsDiv.addEventListener('click', e => {
    if(isEvaluated) return;
    const s = e.target.closest('.slot'); if(!s) return;

    if(sel && !s.dataset.value) {
      s.textContent = sel.textContent;
      s.dataset.value = sel.textContent;
      sel.remove();
      sel = null;
      checkAndMarkPage(idx);
    }
    else if(s.dataset.value && !sel) {
      const w = s.dataset.value;
      s.textContent = '';
      delete s.dataset.value;
      const c = document.createElement('div');
      c.className = 'card';
      c.textContent = w;
      cardsDiv.appendChild(c);
      checkAndMarkPage(idx);
    }
  });
});

// --- Navig√°cia ---
function updateNav() {
  document.querySelectorAll('.task').forEach((t, i) => {
    t.classList.toggle('active', i === currentTaskIndex);
  });
  
  pagContainer.innerHTML = '';
  activeData.forEach((_, i) => {
    const taskEl = taskContainer.children[i];
    const slots = taskEl.querySelectorAll('.slot');
    const allSlotsFilled = [...slots].every(s => s.dataset.value);

    const btn = document.createElement('button');
    btn.className = 'page-btn' + (i === currentTaskIndex ? ' active' : '') + (allSlotsFilled ? ' solved' : '');
    btn.textContent = i + 1;
    btn.onclick = () => { if(!isEvaluated) goToTask(i); };
    pagContainer.appendChild(btn);
  });

  if (currentTaskIndex === activeData.length - 1) {
    nextBtn.style.display = 'none';
    evalBtn.style.display = 'inline-block';
  } else {
    nextBtn.style.display = 'inline-block';
    evalBtn.style.display = 'none';
  }
}

function goToTask(index) {
  currentTaskIndex = index;
  updateNav();
}

nextBtn.addEventListener('click', () => {
  if (currentTaskIndex < activeData.length - 1) {
    currentTaskIndex++;
    updateNav();
  }
});

// --- Vyhodnotenie (Bod za slovo) ---
evalBtn.addEventListener('click', () => {
  const sNameInput = document.getElementById('studentName');
  if(!sNameInput.value.trim()){
    if(!confirm('Nezadali ste meno ≈æiaka. Chcete napriek tomu vyhodnoti≈•?')) return;
  }
  if(!confirm('Naozaj chcete ukonƒçi≈• cviƒçenie a zobrazi≈• v√Ωsledky?')) return;
  
  isEvaluated = true;
  instruction.style.display = 'none';
  navControls.style.display = 'none';
  sNameInput.disabled = true;
  document.querySelector('.settings-box button').disabled = true;
  document.getElementById('limitInput').disabled = true;
  
  document.querySelectorAll('.task').forEach(t => t.style.display = 'block');
  
  let globalPoints = 0;
  let globalMaxPoints = 0;

  activeData.forEach((vars, idx) => {
    const taskEl = taskContainer.children[idx];
    const slots = taskEl.querySelectorAll('.slot');
    const userAns = [...slots].map(s => s.dataset.value || '');
    
    let bestMatchScore = -1;
    let bestVariant = vars[0];
    let bestMatchIndices = []; 

    vars.forEach(variant => {
        let currentScore = 0;
        let currentIndices = [];
        for(let i=0; i < Math.max(variant.length, userAns.length); i++) {
            if(i < variant.length && i < userAns.length && variant[i] === userAns[i]) {
                currentScore++;
                currentIndices.push(true);
            } else {
                currentIndices.push(false);
            }
        }
        if (currentScore > bestMatchScore) {
            bestMatchScore = currentScore;
            bestVariant = variant;
            bestMatchIndices = currentIndices;
        }
    });

    const maxPointsForTask = bestVariant.length;
    globalPoints += bestMatchScore;
    globalMaxPoints += maxPointsForTask;

    // Vizu√°lne zafarbenie na obrazovke
    slots.forEach((slot, i) => {
        if (bestMatchIndices[i]) {
            slot.classList.add('correct');
        } else {
            slot.classList.add('incorrect');
        }
    });

    const statusSpan = document.createElement('span');
    statusSpan.className = 'status-score';
    statusSpan.textContent = \`\${bestMatchScore} / \${maxPointsForTask} b\`;
    taskEl.querySelector('.slots').appendChild(statusSpan);
    taskEl.querySelectorAll('.card').forEach(c => c.style.cursor = 'default');
  });

  const percent = globalMaxPoints > 0 ? Math.round((globalPoints / globalMaxPoints) * 100) : 0;
  const now = new Date();
  
  document.getElementById('resName').textContent = sNameInput.value || 'Bez mena';
  document.getElementById('resScore').textContent = globalPoints + ' / ' + globalMaxPoints;
  document.getElementById('resPercent').textContent = percent + ' %';
  document.getElementById('resTime').textContent = now.toLocaleDateString('sk-SK') + ' ' + now.toLocaleTimeString('sk-SK');
  
  finalSummary.style.display = 'block';
  finalSummary.scrollIntoView({behavior: 'smooth'});
});

updateNav();

// --- Detailn√© v√Ωsledky (Upraven√© pre ƒçiernobielu tlaƒç) ---
document.getElementById('detailBtn').addEventListener('click', () => {
  const title = "${escapeHtml(title)}";
  const name = document.getElementById('resName').textContent;
  const score = document.getElementById('resScore').textContent;
  const percent = document.getElementById('resPercent').textContent;
  const time = document.getElementById('resTime').textContent;
  
  let content = '';
  
  activeData.forEach((vars, idx) => {
    const taskEl = taskContainer.children[idx];
    const slots = taskEl.querySelectorAll('.slot');
    const userWords = [...slots].map(s => s.dataset.value || '___');
    
    // N√°jdenie najlep≈°ieho variantu pre zobrazenie
    let bestMatchScore = -1;
    let bestVariant = vars[0];
    
    vars.forEach(variant => {
        let currentScore = 0;
        for(let i=0; i < Math.max(variant.length, userWords.length); i++) {
            if(i < variant.length && i < userWords.length && variant[i] === userWords[i]) {
                currentScore++;
            }
        }
        if (currentScore > bestMatchScore) {
            bestMatchScore = currentScore;
            bestVariant = variant;
        }
    });

    // Zostavenie HTML pre riadok s FAJKAMI a KR√ç≈ΩIKMI
    let visualizedSentence = '';
    userWords.forEach((w, i) => {
        const isCorrect = (i < bestVariant.length && w === bestVariant[i]);
        // Pou≈æ√≠vame symboly namiesto farieb
        const symbol = isCorrect ? '‚úî' : '‚úñ';
        // Prid√°me span pre neru≈°iv√© form√°tovanie
        visualizedSentence += \`<span style="white-space:nowrap; margin-right: 0.5em; display:inline-block;">\${w} <b>\${symbol}</b></span> \`;
    });

    const isFullyCorrect = (bestMatchScore === bestVariant.length);
    const maxP = bestVariant.length;
    
    content += '<div class="report-task">';
    content += '<strong>√öloha ' + (idx + 1) + ' (' + bestMatchScore + '/' + maxP + ' b):</strong><br>';
    // Odstr√°nen√© farebn√© pozadie, iba jednoduch√Ω r√°mik pre ƒçitateƒænos≈•
    content += '<div style="padding:10px; border:1px solid #333; margin:5px 0;">' + visualizedSentence + '</div>';
    
    if (!isFullyCorrect) {
      content += '<div style="font-size:0.9em; margin-top:5px;"><i>Spr√°vne rie≈°enie:</i> ' + bestVariant.join(' ') + '</div>';
    }
    content += '</div><hr>';
  });

  const win = window.open('', '_blank');
  win.document.write(\`
    <!DOCTYPE html>
    <html lang="sk">
    <head>
      <meta charset="utf-8">
      <title>Detailn√© v√Ωsledky - \${title}</title>
      <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; line-height: 1.5; color: #000; }
        h1 { margin-bottom: 5px; }
        .header { padding: 15px; border: 1px solid #000; margin-bottom: 20px; }
        .report-task { margin-bottom: 15px; page-break-inside: avoid; }
        .legend { margin-top: 30px; font-size: 0.9em; border-top: 2px solid #000; padding-top: 10px; }
        @media print {
          .no-print { display: none; }
          body { max-width: 100%; color: black; }
        }
      </style>
    </head>
    <body>
      <h1>Detailn√Ω prehƒæad v√Ωsledkov</h1>
      <div class="header">
        <strong>Cviƒçenie:</strong> \${title}<br>
        <strong>≈Ωiak:</strong> \${name}<br>
        <strong>Hodnotenie:</strong> \${score} (\${percent})<br>
        <strong>D√°tum:</strong> \${time}
      </div>
      
      <div class="results">
        \${content}
      </div>
      
      <div class="legend">
        <strong>Vysvetlivky:</strong><br>
        ‚úî = Spr√°vne umiestnen√© slovo (+1 bod)<br>
        ‚úñ = Nespr√°vne slovo alebo poz√≠cia (0 bodov)
      </div>
      
      <div class="no-print" style="margin-top:20px; text-align:center;">
        <button onclick="window.print()" style="padding:10px 20px; font-size:16px; cursor:pointer;">üñ® Vytlaƒçi≈• (Ctrl + P)</button>
        <button onclick="window.close()" style="padding:10px 20px; font-size:16px; cursor:pointer;">Zavrie≈•</button>
      </div>
    </body>
    </html>
  \`);
  win.document.close();
});

<\/script>

<br><br>
  <b>Spracovala pomocou UI:</b> Mgr. Erika Matyiov√° (2025)
<br><br>
</body></html>`;
}

/* ---------- Generovanie a ulo≈æenie ---------- */
document.getElementById('genBtn').addEventListener('click',()=>{
 const title=document.getElementById('title').value||'Cviƒçenie';
 const student=document.getElementById('student').value||'';
 const data=parseInput(document.getElementById('input').value);
 if(!data.length){alert('Zadaj aspo≈à jednu vetu.');return;}
 const html=buildExerciseHTML(title,student,data);
 document.getElementById('previewFrame').srcdoc=html;
 window.generatedHTML=html;
});

document.getElementById('openWinBtn').addEventListener('click',()=>{
 if(!window.generatedHTML){alert('Najprv vygeneruj cviƒçenie.');return;}
 const w=window.open();w.document.open();w.document.write(window.generatedHTML);w.document.close();
});

document.getElementById('saveBtn').addEventListener('click',()=>{
 if(!window.generatedHTML){alert('Najprv vygeneruj cviƒçenie.');return;}
 const blob=new Blob([window.generatedHTML],{type:'text/html'});
 const a=document.createElement('a');
 a.href=URL.createObjectURL(blob);
 a.download=(document.getElementById('title').value||'cvicenie')+'.html';
 document.body.appendChild(a); a.click(); document.body.removeChild(a);
});
</script>
<script>
/* ---------- Podpora kl√°vesy TAB vo vstupnom poli ---------- */
document.getElementById("input").addEventListener("keydown", function(e) {
  if (e.key === "Tab") {
    e.preventDefault();
    const start = this.selectionStart;
    const end = this.selectionEnd;
    this.value = this.value.substring(0, start) + "\t" + this.value.substring(end);
    this.selectionStart = this.selectionEnd = start + 1;
  }
});
</script>
 <br><br>
    <b>Spracovala pomocou UI:</b> Mgr. Erika Matyiov√° (2025)
    <br><br>
</body>
</html>